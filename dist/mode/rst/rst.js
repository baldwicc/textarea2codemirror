!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror"),require("../python/python"),require("../stex/stex"),require("../../addon/mode/overlay")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../python/python","../stex/stex","../../addon/mode/overlay"],a):a(CodeMirror)}(function(a){"use strict";a.defineMode("rst",function(b,c){var d=/^\*\*[^\*\s](?:[^\*]*[^\*\s])?\*\*/,e=/^\*[^\*\s](?:[^\*]*[^\*\s])?\*/,f=/^``[^`\s](?:[^`]*[^`\s])``/,g=/^(?:[\d]+(?:[\.,]\d+)*)/,h=/^(?:\s\+[\d]+(?:[\.,]\d+)*)/,i=/^(?:\s\-[\d]+(?:[\.,]\d+)*)/,j="[Hh][Tt][Tt][Pp][Ss]?://",k="(?:[\\d\\w.-]+)\\.(?:\\w{2,6})",l="(?:/[\\d\\w\\#\\%\\&\\-\\.\\,\\/\\:\\=\\?\\~]+)*",m=new RegExp("^"+j+k+l),n={token:function(a){if(a.match(d)&&a.match(/\W+|$/,!1))return"strong";if(a.match(e)&&a.match(/\W+|$/,!1))return"em";if(a.match(f)&&a.match(/\W+|$/,!1))return"string-2";if(a.match(g))return"number";if(a.match(h))return"positive";if(a.match(i))return"negative";if(a.match(m))return"link";for(;!(null==a.next()||a.match(d,!1)||a.match(e,!1)||a.match(f,!1)||a.match(g,!1)||a.match(h,!1)||a.match(i,!1)||a.match(m,!1)););return null}},o=a.getMode(b,c.backdrop||"rst-base");return a.overlayMode(o,n,!0)},"python","stex"),a.defineMode("rst-base",function(b){function c(a){var b=Array.prototype.slice.call(arguments,1);return a.replace(/{(\d+)}/g,function(a,c){return"undefined"!=typeof b[c]?b[c]:a})}function d(a){this.message=a}function e(a,b){if(!a)throw new d(b);return a}function f(b,c){var d=null;if(b.sol()&&b.match($,!1))m(c,k,{mode:p,local:a.startState(p)});else if(b.sol()&&b.match(C))m(c,g),d="meta";else if(b.sol()&&b.match(B))m(c,f),d="header";else if(o(c)==N||b.match(N,!1))switch(n(c)){case 0:m(c,f,l(N,1)),e(b.match(/^:/)),d="meta";break;case 1:m(c,f,l(N,2)),e(b.match(v)),d="keyword",b.current().match(/^(?:math|latex)/)&&(c.tmp_stex=!0);break;case 2:m(c,f,l(N,3)),e(b.match(/^:`/)),d="meta";break;case 3:if(c.tmp_stex&&(c.tmp_stex=void 0,c.tmp={mode:q,local:a.startState(q)}),c.tmp){if("`"==b.peek()){m(c,f,l(N,4)),c.tmp=void 0;break}d=c.tmp.mode.token(b,c.tmp.local);break}m(c,f,l(N,4)),e(b.match(A)),d="string";break;case 4:m(c,f,l(N,5)),e(b.match(/^`/)),d="meta";break;case 5:m(c,f,l(N,6)),e(b.match(t));break;default:m(c,f),e(""==b.current())}else if(o(c)==O||b.match(O,!1))switch(n(c)){case 0:m(c,f,l(O,1)),e(b.match(/^`/)),d="meta";break;case 1:m(c,f,l(O,2)),e(b.match(A)),d="string";break;case 2:m(c,f,l(O,3)),e(b.match(/^`:/)),d="meta";break;case 3:m(c,f,l(O,4)),e(b.match(v)),d="keyword";break;case 4:m(c,f,l(O,5)),e(b.match(/^:/)),d="meta";break;case 5:m(c,f,l(O,6)),e(b.match(t));break;default:m(c,f),e(""==b.current())}else if(o(c)==P||b.match(P,!1))switch(n(c)){case 0:m(c,f,l(P,1)),e(b.match(/^:/)),d="meta";break;case 1:m(c,f,l(P,2)),e(b.match(v)),d="keyword";break;case 2:m(c,f,l(P,3)),e(b.match(/^:/)),d="meta";break;case 3:m(c,f,l(P,4)),e(b.match(t));break;default:m(c,f),e(""==b.current())}else if(o(c)==I||b.match(I,!1))switch(n(c)){case 0:m(c,f,l(I,1)),e(b.match(S)),d="variable-2";break;case 1:m(c,f,l(I,2)),b.match(/^_?_?/)&&(d="link");break;default:m(c,f),e(""==b.current())}else if(b.match(J))m(c,f),d="quote";else if(b.match(K))m(c,f),d="quote";else if(b.match(L))m(c,f),(!b.peek()||b.peek().match(/^\W$/))&&(d="link");else if(o(c)==M||b.match(M,!1))switch(n(c)){case 0:!b.peek()||b.peek().match(/^\W$/)?m(c,f,l(M,1)):b.match(M);break;case 1:m(c,f,l(M,2)),e(b.match(/^`/)),d="link";break;case 2:m(c,f,l(M,3)),e(b.match(A));break;case 3:m(c,f,l(M,4)),e(b.match(/^`_/)),d="link";break;default:m(c,f),e(""==b.current())}else b.match(Z)?m(c,i):b.next()&&m(c,f);return d}function g(b,c){var d=null;if(o(c)==F||b.match(F,!1))switch(n(c)){case 0:m(c,g,l(F,1)),e(b.match(S)),d="variable-2";break;case 1:m(c,g,l(F,2)),e(b.match(T));break;case 2:m(c,g,l(F,3)),e(b.match(U)),d="keyword";break;case 3:m(c,g,l(F,4)),e(b.match(V)),d="meta";break;default:m(c,f),e(""==b.current())}else if(o(c)==E||b.match(E,!1))switch(n(c)){case 0:m(c,g,l(E,1)),e(b.match(Q)),d="keyword",b.current().match(/^(?:math|latex)/)?c.tmp_stex=!0:b.current().match(/^python/)&&(c.tmp_py=!0);break;case 1:m(c,g,l(E,2)),e(b.match(R)),d="meta",(b.match(/^latex\s*$/)||c.tmp_stex)&&(c.tmp_stex=void 0,m(c,k,{mode:q,local:a.startState(q)}));break;case 2:m(c,g,l(E,3)),(b.match(/^python\s*$/)||c.tmp_py)&&(c.tmp_py=void 0,m(c,k,{mode:p,local:a.startState(p)}));break;default:m(c,f),e(""==b.current())}else if(o(c)==D||b.match(D,!1))switch(n(c)){case 0:m(c,g,l(D,1)),e(b.match(W)),e(b.match(X)),d="link";break;case 1:m(c,g,l(D,2)),e(b.match(Y)),d="meta";break;default:m(c,f),e(""==b.current())}else b.match(G)?(m(c,f),d="quote"):b.match(H)?(m(c,f),d="quote"):(b.eatSpace(),b.eol()?m(c,f):(b.skipToEnd(),m(c,h),d="comment"));return d}function h(a,b){return j(a,b,"comment")}function i(a,b){return j(a,b,"meta")}function j(a,b,c){return a.eol()||a.eatSpace()?(a.skipToEnd(),c):(m(b,f),null)}function k(a,b){return b.ctx.mode&&b.ctx.local?a.sol()?(a.eatSpace()||m(b,f),null):b.ctx.mode.token(a,b.ctx.local):(m(b,f),null)}function l(a,b,c,d){return{phase:a,stage:b,mode:c,local:d}}function m(a,b,c){a.tok=b,a.ctx=c||{}}function n(a){return a.ctx.stage||0}function o(a){return a.ctx.phase}d.prototype.toString=function(){return"AssertException: "+this.message};var p=a.getMode(b,"python"),q=a.getMode(b,"stex"),r="\\s+",s="(?:\\s*|\\W|$)",t=new RegExp(c("^{0}",s)),u="(?:[^\\W\\d_](?:[\\w!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)",v=new RegExp(c("^{0}",u)),w="(?:[^\\W\\d_](?:[\\w\\s!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)",x=c("(?:{0}|`{1}`)",u,w),y="(?:[^\\s\\|](?:[^\\|]*[^\\s\\|])?)",z="(?:[^\\`]+)",A=new RegExp(c("^{0}",z)),B=new RegExp("^([!'#$%&\"()*+,-./:;<=>?@\\[\\\\\\]^_`{|}~])\\1{3,}\\s*$"),C=new RegExp(c("^\\.\\.{0}",r)),D=new RegExp(c("^_{0}:{1}|^__:{1}",x,s)),E=new RegExp(c("^{0}::{1}",x,s)),F=new RegExp(c("^\\|{0}\\|{1}{2}::{3}",y,r,x,s)),G=new RegExp(c("^\\[(?:\\d+|#{0}?|\\*)]{1}",x,s)),H=new RegExp(c("^\\[{0}\\]{1}",x,s)),I=new RegExp(c("^\\|{0}\\|",y)),J=new RegExp(c("^\\[(?:\\d+|#{0}?|\\*)]_",x)),K=new RegExp(c("^\\[{0}\\]_",x)),L=new RegExp(c("^{0}__?",x)),M=new RegExp(c("^`{0}`_",z)),N=new RegExp(c("^:{0}:`{1}`{2}",u,z,s)),O=new RegExp(c("^`{1}`:{0}:{2}",u,z,s)),P=new RegExp(c("^:{0}:{1}",u,s)),Q=new RegExp(c("^{0}",x)),R=new RegExp(c("^::{0}",s)),S=new RegExp(c("^\\|{0}\\|",y)),T=new RegExp(c("^{0}",r)),U=new RegExp(c("^{0}",x)),V=new RegExp(c("^::{0}",s)),W=new RegExp("^_"),X=new RegExp(c("^{0}|_",x)),Y=new RegExp(c("^:{0}",s)),Z=new RegExp("^::\\s*$"),$=new RegExp("^\\s+(?:>>>|In \\[\\d+\\]:)\\s");return{startState:function(){return{tok:f,ctx:l(void 0,0)}},copyState:function(b){var c=b.ctx,d=b.tmp;return c.local&&(c={mode:c.mode,local:a.copyState(c.mode,c.local)}),d&&(d={mode:d.mode,local:a.copyState(d.mode,d.local)}),{tok:b.tok,ctx:c,tmp:d}},innerMode:function(a){return a.tmp?{state:a.tmp.local,mode:a.tmp.mode}:a.ctx.mode?{state:a.ctx.local,mode:a.ctx.mode}:null},token:function(a,b){return b.tok(a,b)}}},"python","stex"),a.defineMIME("text/x-rst","rst")});