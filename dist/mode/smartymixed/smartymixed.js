!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../smarty/smarty")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../htmlmixed/htmlmixed","../smarty/smarty"],a):a(CodeMirror)}(function(a){"use strict";a.defineMode("smartymixed",function(b){var c,d,e,f,g=a.getMode(b,"htmlmixed"),h=a.getMode(b,"smarty"),c={rightDelimiter:"}",leftDelimiter:"{"};return b.hasOwnProperty("leftDelimiter")&&(c.leftDelimiter=b.leftDelimiter),b.hasOwnProperty("rightDelimiter")&&(c.rightDelimiter=b.rightDelimiter),d={smartyComment:new RegExp("^"+c.leftDelimiter+"\\*"),literalOpen:new RegExp(c.leftDelimiter+"literal"+c.rightDelimiter),literalClose:new RegExp(c.leftDelimiter+"/literal"+c.rightDelimiter),hasLeftDelimeter:new RegExp(".*"+c.leftDelimiter),htmlHasLeftDelimeter:new RegExp("[^<>]*"+c.leftDelimiter)},e={chain:function(a,b,c){return b.tokenize=c,c(a,b)},cleanChain:function(a,b,c){return b.tokenize=null,b.localState=null,b.localMode=null,"string"==typeof c?c?c:null:c(a,b)},maybeBackup:function(a,b,c){var d,e=a.current(),f=e.search(b);return f>-1?a.backUp(e.length-f):(d=e.match(/<\/?$/))&&(a.backUp(e.length),a.match(b,!1)||a.match(e[0])),c}},f={html:function(a,b){return!b.inLiteral&&a.match(d.htmlHasLeftDelimeter,!1)&&null===b.htmlMixedState.htmlState.tagName?(b.tokenize=f.smarty,b.localMode=h,b.localState=h.startState(g.indent(b.htmlMixedState,"")),e.maybeBackup(a,c.leftDelimiter,h.token(a,b.localState))):!b.inLiteral&&a.match(c.leftDelimiter,!1)?(b.tokenize=f.smarty,b.localMode=h,b.localState=h.startState(g.indent(b.htmlMixedState,"")),e.maybeBackup(a,c.leftDelimiter,h.token(a,b.localState))):g.token(a,b.htmlMixedState)},smarty:function(a,b){if(a.match(c.leftDelimiter,!1)){if(a.match(d.smartyComment,!1))return e.chain(a,b,f.inBlock("comment","*"+c.rightDelimiter))}else if(a.match(c.rightDelimiter,!1))return a.eat(c.rightDelimiter),b.tokenize=f.html,b.localMode=g,b.localState=b.htmlMixedState,"tag";return e.maybeBackup(a,c.rightDelimiter,h.token(a,b.localState))},inBlock:function(a,b){return function(c,d){for(;!c.eol();){if(c.match(b)){e.cleanChain(c,d,"");break}c.next()}return a}}},{startState:function(){var a=g.startState();return{token:f.html,localMode:null,localState:null,htmlMixedState:a,tokenize:null,inLiteral:!1}},copyState:function(b){var c=null,d=b.tokenize||b.token;return b.localState&&(c=a.copyState(d!=f.html?h:g,b.localState)),{token:b.token,tokenize:b.tokenize,localMode:b.localMode,localState:c,htmlMixedState:a.copyState(g,b.htmlMixedState),inLiteral:b.inLiteral}},token:function(a,b){if(a.match(c.leftDelimiter,!1)){if(!b.inLiteral&&a.match(d.literalOpen,!0))return b.inLiteral=!0,"keyword";if(b.inLiteral&&a.match(d.literalClose,!0))return b.inLiteral=!1,"keyword"}b.inLiteral&&b.localState!=b.htmlMixedState&&(b.tokenize=f.html,b.localMode=g,b.localState=b.htmlMixedState);var e=(b.tokenize||b.token)(a,b);return e},indent:function(b,c){return b.localMode==h||b.inLiteral&&!b.localMode||d.hasLeftDelimeter.test(c)?a.Pass:g.indent(b.htmlMixedState,c)},innerMode:function(a){return{state:a.localState||a.htmlMixedState,mode:a.localMode||g}}}},"htmlmixed","smarty"),a.defineMIME("text/x-smarty","smartymixed")});