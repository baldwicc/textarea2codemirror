!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)}(function(a){function b(a,b){var c=a.getRange(h(b.line,b.ch-1),h(b.line,b.ch+1));return 2==c.length?c:null}function c(c){for(var d={name:"autoCloseBrackets",Backspace:function(d){if(d.getOption("disableInput"))return a.Pass;for(var e=d.listSelections(),f=0;f<e.length;f++){if(!e[f].empty())return a.Pass;var g=b(d,e[f].head);if(!g||c.indexOf(g)%2!=0)return a.Pass}for(var f=e.length-1;f>=0;f--){var i=e[f].head;d.replaceRange("",h(i.line,i.ch-1),h(i.line,i.ch+1))}}},e="",f=0;f<c.length;f+=2)(function(b,c){b!=c&&(e+=c),d["'"+b+"'"]=function(d){if(d.getOption("disableInput"))return a.Pass;for(var f,i,j=d.listSelections(),k=0;k<j.length;k++){var l,m=j[k],n=m.head;if("'"==b&&"comment"==d.getTokenTypeAt(n))return a.Pass;var i=d.getRange(n,h(n.line,n.ch+1));if(m.empty())if(b==c&&i==c)l=d.getRange(n,h(n.line,n.ch+3))==b+b+b?"skipThree":"skip";else if(b==c&&n.ch>1&&d.getRange(h(n.line,n.ch-2),n)==b+b&&(n.ch<=2||d.getRange(h(n.line,n.ch-3),h(n.line,n.ch-2))!=b))l="addFour";else{if(b==c&&a.isWordChar(i))return a.Pass;if(!(d.getLine(n.line).length==n.ch||e.indexOf(i)>=0||g.test(i)))return a.Pass;l="both"}else l="surround";if(f){if(f!=l)return a.Pass}else f=l}d.operation(function(){if("skip"==f)d.execCommand("goCharRight");else if("skipThree"==f)for(var a=0;3>a;a++)d.execCommand("goCharRight");else if("surround"==f){for(var e=d.getSelections(),a=0;a<e.length;a++)e[a]=b+e[a]+c;d.replaceSelections(e,"around")}else"both"==f?(d.replaceSelection(b+c,null),d.execCommand("goCharLeft")):"addFour"==f&&(d.replaceSelection(b+b+b+b,"before"),d.execCommand("goCharRight"))})},b!=c&&(d["'"+c+"'"]=function(b){for(var d=b.listSelections(),e=0;e<d.length;e++){var f=d[e];if(!f.empty()||b.getRange(f.head,h(f.head.line,f.head.ch+1))!=c)return a.Pass}b.execCommand("goCharRight")})})(c.charAt(f),c.charAt(f+1));return d}function d(c){return function(d){if(d.getOption("disableInput"))return a.Pass;for(var e=d.listSelections(),f=0;f<e.length;f++){if(!e[f].empty())return a.Pass;var g=b(d,e[f].head);if(!g||c.indexOf(g)%2!=0)return a.Pass}d.operation(function(){d.replaceSelection("\n\n",null),d.execCommand("goCharLeft"),e=d.listSelections();for(var a=0;a<e.length;a++){var b=e[a].head.line;d.indentLine(b,null,!0),d.indentLine(b+1,null,!0)}})}}var e="()[]{}''\"\"",f="[]{}",g=/\s/,h=a.Pos;a.defineOption("autoCloseBrackets",!1,function(b,g,h){if(h!=a.Init&&h&&b.removeKeyMap("autoCloseBrackets"),g){var i=e,j=f;"string"==typeof g?i=g:"object"==typeof g&&(null!=g.pairs&&(i=g.pairs),null!=g.explode&&(j=g.explode));var k=c(i);j&&(k.Enter=d(j)),b.addKeyMap(k)}})});