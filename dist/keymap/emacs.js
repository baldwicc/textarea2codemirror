!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../lib/codemirror")):"function"==typeof define&&define.amd?define(["../lib/codemirror"],a):a(CodeMirror)}(function(a){"use strict";function b(a,b){return a.line==b.line&&a.ch==b.ch}function c(a){H.push(a),H.length>50&&H.shift()}function d(a){return H.length?void(H[H.length-1]+=a):c(a)}function e(a){return H[H.length-(a?Math.min(a,1):1)]||""}function f(){return H.length>1&&H.pop(),e()}function g(a,e,f,g,h){null==h&&(h=a.getRange(e,f)),g&&I&&I.cm==a&&b(e,I.pos)&&a.isClean(I.gen)?d(h):c(h),a.replaceRange("",e,f,"+delete"),I=g?{cm:a,pos:e,gen:a.changeGeneration()}:null}function h(a,b,c){return a.findPosH(b,c,"char",!0)}function i(a,b,c){return a.findPosH(b,c,"word",!0)}function j(a,b,c){return a.findPosV(b,c,"line",a.doc.sel.goalColumn)}function k(a,b,c){return a.findPosV(b,c,"page",a.doc.sel.goalColumn)}function l(a,b,c){for(var d=b.line,e=a.getLine(d),f=/\S/.test(0>c?e.slice(0,b.ch):e.slice(b.ch)),g=a.firstLine(),h=a.lastLine();;){if(d+=c,g>d||d>h)return a.clipPos(G(d-c,0>c?0:null));e=a.getLine(d);var i=/\S/.test(e);if(i)f=!0;else if(f)return G(d,0)}}function m(a,b,c){for(var d=b.line,e=b.ch,f=a.getLine(b.line),g=!1;;){var h=f.charAt(e+(0>c?-1:0));if(h){if(g&&/[!?.]/.test(h))return G(d,e+(c>0?1:0));g||(g=/\w/.test(h)),e+=c}else{if(d==(0>c?a.firstLine():a.lastLine()))return G(d,e);if(f=a.getLine(d+c),!/\S/.test(f))return G(d,e);d+=c,e=0>c?f.length:0}}}function n(a,c,d){var e;if(a.findMatchingBracket&&(e=a.findMatchingBracket(c,!0))&&e.match&&(e.forward?1:-1)==d)return d>0?G(e.to.line,e.to.ch+1):e.to;for(var f=!0;;f=!1){var g=a.getTokenAt(c),h=G(c.line,0>d?g.start:g.end);if(!(f&&d>0&&g.end==c.ch)&&/\w/.test(g.string))return h;var i=a.findPosH(h,d,"char");if(b(h,i))return c;c=i}}function o(a,b){var c=a.state.emacsPrefix;return c?(v(a),"-"==c?-1:Number(c)):b?null:1}function p(a){var b="string"==typeof a?function(b){b.execCommand(a)}:a;return function(a){var c=o(a);b(a);for(var d=1;c>d;++d)b(a)}}function q(a,c,d){var e=a.getCursor(),f=o(a);0>f&&(d=-d,f=-f);for(var g=0;f>g;++g){var h=c(a,e,d);if(b(h,e))break;e=h}return e}function r(a,b){var c=function(c){c.extendSelection(q(c,a,b))};return c.motion=!0,c}function s(a,b,c){g(a,a.getCursor(),q(a,b,c),!0)}function t(a,b){return a.state.emacsPrefix?void("-"!=b&&(a.state.emacsPrefix+=b)):(a.state.emacsPrefix=b,a.on("keyHandled",u),void a.on("inputRead",w))}function u(a,b){a.state.emacsPrefixMap||J.hasOwnProperty(b)||v(a)}function v(a){a.state.emacsPrefix=null,a.off("keyHandled",u),a.off("inputRead",w)}function w(a,b){var c=o(a);if(c>1&&"+input"==b.origin){for(var d=b.text.join("\n"),e="",f=1;c>f;++f)e+=d;a.replaceSelection(e)}}function x(a){a.state.emacsPrefixMap=!0,a.addKeyMap(L),a.on("keyHandled",y),a.on("inputRead",y)}function y(a,b){("string"!=typeof b||!/^\d$/.test(b)&&"Ctrl-U"!=b)&&(a.removeKeyMap(L),a.state.emacsPrefixMap=!1,a.off("keyHandled",y),a.off("inputRead",y))}function z(a){a.setCursor(a.getCursor()),a.setExtending(!a.getExtending()),a.on("change",function(){a.setExtending(!1)})}function A(a){a.setExtending(!1),a.setCursor(a.getCursor())}function B(a,b,c){a.openDialog?a.openDialog(b+': <input type="text" style="width: 10em"/>',c,{bottom:!0}):c(prompt(b,""))}function C(a,b){var c=a.getCursor(),d=a.findPosH(c,1,"word");a.replaceRange(b(a.getRange(c,d)),c,d),a.setCursor(d)}function D(a){for(var b=a.getCursor(),c=b.line,d=b.ch,e=[];c>=a.firstLine();){for(var f=a.getLine(c),g=null==d?f.length:d;g>0;){var d=f.charAt(--g);if(")"==d)e.push("(");else if("]"==d)e.push("[");else if("}"==d)e.push("{");else if(/[\(\{\[]/.test(d)&&(!e.length||e.pop()!=d))return a.extendSelection(G(c,g))}--c,d=null}}function E(a){a.execCommand("clearSearch"),A(a)}function F(a){L[a]=function(b){t(b,a)},K["Ctrl-"+a]=function(b){t(b,a)},J["Ctrl-"+a]=!0}var G=a.Pos,H=[],I=null,J={"Alt-G":!0,"Ctrl-X":!0,"Ctrl-Q":!0,"Ctrl-U":!0},K=a.keyMap.emacs={"Ctrl-W":function(a){g(a,a.getCursor("start"),a.getCursor("end"))},"Ctrl-K":p(function(a){var b=a.getCursor(),c=a.clipPos(G(b.line)),d=a.getRange(b,c);/\S/.test(d)||(d+="\n",c=G(b.line+1,0)),g(a,b,c,!0,d)}),"Alt-W":function(a){c(a.getSelection()),A(a)},"Ctrl-Y":function(a){var b=a.getCursor();a.replaceRange(e(o(a)),b,b,"paste"),a.setSelection(b,a.getCursor())},"Alt-Y":function(a){a.replaceSelection(f(),"around","paste")},"Ctrl-Space":z,"Ctrl-Shift-2":z,"Ctrl-F":r(h,1),"Ctrl-B":r(h,-1),Right:r(h,1),Left:r(h,-1),"Ctrl-D":function(a){s(a,h,1)},Delete:function(a){s(a,h,1)},"Ctrl-H":function(a){s(a,h,-1)},Backspace:function(a){s(a,h,-1)},"Alt-F":r(i,1),"Alt-B":r(i,-1),"Alt-D":function(a){s(a,i,1)},"Alt-Backspace":function(a){s(a,i,-1)},"Ctrl-N":r(j,1),"Ctrl-P":r(j,-1),Down:r(j,1),Up:r(j,-1),"Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd",End:"goLineEnd",Home:"goLineStart","Alt-V":r(k,-1),"Ctrl-V":r(k,1),PageUp:r(k,-1),PageDown:r(k,1),"Ctrl-Up":r(l,-1),"Ctrl-Down":r(l,1),"Alt-A":r(m,-1),"Alt-E":r(m,1),"Alt-K":function(a){s(a,m,1)},"Ctrl-Alt-K":function(a){s(a,n,1)},"Ctrl-Alt-Backspace":function(a){s(a,n,-1)},"Ctrl-Alt-F":r(n,1),"Ctrl-Alt-B":r(n,-1),"Shift-Ctrl-Alt-2":function(a){a.setSelection(q(a,n,1),a.getCursor())},"Ctrl-Alt-T":function(a){var b=n(a,a.getCursor(),-1),c=n(a,b,1),d=n(a,c,1),e=n(a,d,-1);a.replaceRange(a.getRange(e,d)+a.getRange(c,e)+a.getRange(b,c),b,d)},"Ctrl-Alt-U":p(D),"Alt-Space":function(a){for(var b=a.getCursor(),c=b.ch,d=b.ch,e=a.getLine(b.line);c&&/\s/.test(e.charAt(c-1));)--c;for(;d<e.length&&/\s/.test(e.charAt(d));)++d;a.replaceRange(" ",G(b.line,c),G(b.line,d))},"Ctrl-O":p(function(a){a.replaceSelection("\n","start")}),"Ctrl-T":p(function(a){a.execCommand("transposeChars")}),"Alt-C":p(function(a){C(a,function(a){var b=a.search(/\w/);return-1==b?a:a.slice(0,b)+a.charAt(b).toUpperCase()+a.slice(b+1).toLowerCase()})}),"Alt-U":p(function(a){C(a,function(a){return a.toUpperCase()})}),"Alt-L":p(function(a){C(a,function(a){return a.toLowerCase()})}),"Alt-;":"toggleComment","Ctrl-/":p("undo"),"Shift-Ctrl--":p("undo"),"Ctrl-Z":p("undo"),"Cmd-Z":p("undo"),"Shift-Alt-,":"goDocStart","Shift-Alt-.":"goDocEnd","Ctrl-S":"findNext","Ctrl-R":"findPrev","Ctrl-G":E,"Shift-Alt-5":"replace","Alt-/":"autocomplete","Ctrl-J":"newlineAndIndent",Enter:!1,Tab:"indentAuto","Alt-G":function(a){a.setOption("keyMap","emacs-Alt-G")},"Ctrl-X":function(a){a.setOption("keyMap","emacs-Ctrl-X")},"Ctrl-Q":function(a){a.setOption("keyMap","emacs-Ctrl-Q")},"Ctrl-U":x};a.keyMap["emacs-Ctrl-X"]={Tab:function(a){a.indentSelection(o(a,!0)||a.getOption("indentUnit"))},"Ctrl-X":function(a){a.setSelection(a.getCursor("head"),a.getCursor("anchor"))},"Ctrl-S":"save","Ctrl-W":"save",S:"saveAll",F:"open",U:p("undo"),K:"close",Delete:function(a){g(a,a.getCursor(),m(a,a.getCursor(),1),!0)},auto:"emacs",nofallthrough:!0,disableInput:!0},a.keyMap["emacs-Alt-G"]={G:function(a){var b=o(a,!0);return null!=b&&b>0?a.setCursor(b-1):void B(a,"Goto line",function(b){var c;b&&!isNaN(c=Number(b))&&c==c|0&&c>0&&a.setCursor(c-1)})},auto:"emacs",nofallthrough:!0,disableInput:!0},a.keyMap["emacs-Ctrl-Q"]={Tab:p("insertTab"),auto:"emacs",nofallthrough:!0};for(var L={"Ctrl-G":v},M=0;10>M;++M)F(String(M));F("-")});