!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../lib/codemirror"),require("../addon/search/searchcursor"),require("../addon/dialog/dialog"),require("../addon/edit/matchbrackets.js")):"function"==typeof define&&define.amd?define(["../lib/codemirror","../addon/search/searchcursor","../addon/dialog/dialog","../addon/edit/matchbrackets"],a):a(CodeMirror)}(function(a){"use strict";var b=[{keys:["<Left>"],type:"keyToKey",toKeys:["h"]},{keys:["<Right>"],type:"keyToKey",toKeys:["l"]},{keys:["<Up>"],type:"keyToKey",toKeys:["k"]},{keys:["<Down>"],type:"keyToKey",toKeys:["j"]},{keys:["<Space>"],type:"keyToKey",toKeys:["l"]},{keys:["<BS>"],type:"keyToKey",toKeys:["h"]},{keys:["<C-Space>"],type:"keyToKey",toKeys:["W"]},{keys:["<C-BS>"],type:"keyToKey",toKeys:["B"]},{keys:["<S-Space>"],type:"keyToKey",toKeys:["w"]},{keys:["<S-BS>"],type:"keyToKey",toKeys:["b"]},{keys:["<C-n>"],type:"keyToKey",toKeys:["j"]},{keys:["<C-p>"],type:"keyToKey",toKeys:["k"]},{keys:["<C-[>"],type:"keyToKey",toKeys:["<Esc>"]},{keys:["<C-c>"],type:"keyToKey",toKeys:["<Esc>"]},{keys:["s"],type:"keyToKey",toKeys:["c","l"],context:"normal"},{keys:["s"],type:"keyToKey",toKeys:["x","i"],context:"visual"},{keys:["S"],type:"keyToKey",toKeys:["c","c"],context:"normal"},{keys:["S"],type:"keyToKey",toKeys:["d","c","c"],context:"visual"},{keys:["<Home>"],type:"keyToKey",toKeys:["0"]},{keys:["<End>"],type:"keyToKey",toKeys:["$"]},{keys:["<PageUp>"],type:"keyToKey",toKeys:["<C-b>"]},{keys:["<PageDown>"],type:"keyToKey",toKeys:["<C-f>"]},{keys:["<CR>"],type:"keyToKey",toKeys:["j","^"],context:"normal"},{keys:["H"],type:"motion",motion:"moveToTopLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:["M"],type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:["L"],type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:["h"],type:"motion",motion:"moveByCharacters",motionArgs:{forward:!1}},{keys:["l"],type:"motion",motion:"moveByCharacters",motionArgs:{forward:!0}},{keys:["j"],type:"motion",motion:"moveByLines",motionArgs:{forward:!0,linewise:!0}},{keys:["k"],type:"motion",motion:"moveByLines",motionArgs:{forward:!1,linewise:!0}},{keys:["g","j"],type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!0}},{keys:["g","k"],type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!1}},{keys:["w"],type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1}},{keys:["W"],type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1,bigWord:!0}},{keys:["e"],type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,inclusive:!0}},{keys:["E"],type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:["b"],type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1}},{keys:["B"],type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1,bigWord:!0}},{keys:["g","e"],type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,inclusive:!0}},{keys:["g","E"],type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:["{"],type:"motion",motion:"moveByParagraph",motionArgs:{forward:!1,toJumplist:!0}},{keys:["}"],type:"motion",motion:"moveByParagraph",motionArgs:{forward:!0,toJumplist:!0}},{keys:["<C-f>"],type:"motion",motion:"moveByPage",motionArgs:{forward:!0}},{keys:["<C-b>"],type:"motion",motion:"moveByPage",motionArgs:{forward:!1}},{keys:["<C-d>"],type:"motion",motion:"moveByScroll",motionArgs:{forward:!0,explicitRepeat:!0}},{keys:["<C-u>"],type:"motion",motion:"moveByScroll",motionArgs:{forward:!1,explicitRepeat:!0}},{keys:["g","g"],type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:["G"],type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!0,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:["0"],type:"motion",motion:"moveToStartOfLine"},{keys:["^"],type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:["+"],type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0}},{keys:["-"],type:"motion",motion:"moveByLines",motionArgs:{forward:!1,toFirstChar:!0}},{keys:["_"],type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0,repeatOffset:-1}},{keys:["$"],type:"motion",motion:"moveToEol",motionArgs:{inclusive:!0}},{keys:["%"],type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:!0,toJumplist:!0}},{keys:["f","character"],type:"motion",motion:"moveToCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:["F","character"],type:"motion",motion:"moveToCharacter",motionArgs:{forward:!1}},{keys:["t","character"],type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:["T","character"],type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!1}},{keys:[";"],type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!0}},{keys:[","],type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!1}},{keys:["'","character"],type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0,linewise:!0}},{keys:["`","character"],type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0}},{keys:["]","`"],type:"motion",motion:"jumpToMark",motionArgs:{forward:!0}},{keys:["[","`"],type:"motion",motion:"jumpToMark",motionArgs:{forward:!1}},{keys:["]","'"],type:"motion",motion:"jumpToMark",motionArgs:{forward:!0,linewise:!0}},{keys:["[","'"],type:"motion",motion:"jumpToMark",motionArgs:{forward:!1,linewise:!0}},{keys:["]","p"],type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0,matchIndent:!0}},{keys:["[","p"],type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0,matchIndent:!0}},{keys:["]","character"],type:"motion",motion:"moveToSymbol",motionArgs:{forward:!0,toJumplist:!0}},{keys:["[","character"],type:"motion",motion:"moveToSymbol",motionArgs:{forward:!1,toJumplist:!0}},{keys:["|"],type:"motion",motion:"moveToColumn",motionArgs:{}},{keys:["o"],type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{},context:"visual"},{keys:["d"],type:"operator",operator:"delete"},{keys:["y"],type:"operator",operator:"yank"},{keys:["c"],type:"operator",operator:"change"},{keys:[">"],type:"operator",operator:"indent",operatorArgs:{indentRight:!0}},{keys:["<"],type:"operator",operator:"indent",operatorArgs:{indentRight:!1}},{keys:["g","~"],type:"operator",operator:"swapcase"},{keys:["n"],type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:!0}},{keys:["N"],type:"motion",motion:"findNext",motionArgs:{forward:!1,toJumplist:!0}},{keys:["x"],type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!0},operatorMotionArgs:{visualLine:!1}},{keys:["X"],type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!1},operatorMotionArgs:{visualLine:!0}},{keys:["D"],type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:!0},operatorMotionArgs:{visualLine:!0}},{keys:["Y"],type:"operatorMotion",operator:"yank",motion:"moveToEol",motionArgs:{inclusive:!0},operatorMotionArgs:{visualLine:!0}},{keys:["C"],type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:!0},operatorMotionArgs:{visualLine:!0}},{keys:["~"],type:"operatorMotion",operator:"swapcase",operatorArgs:{shouldMoveCursor:!0},motion:"moveByCharacters",motionArgs:{forward:!0}},{keys:["<C-i>"],type:"action",action:"jumpListWalk",actionArgs:{forward:!0}},{keys:["<C-o>"],type:"action",action:"jumpListWalk",actionArgs:{forward:!1}},{keys:["<C-e>"],type:"action",action:"scroll",actionArgs:{forward:!0,linewise:!0}},{keys:["<C-y>"],type:"action",action:"scroll",actionArgs:{forward:!1,linewise:!0}},{keys:["a"],type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"charAfter"}},{keys:["A"],type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"eol"}},{keys:["A"],type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"endOfSelectedArea"},context:"visual"},{keys:["i"],type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"inplace"}},{keys:["I"],type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"firstNonBlank"}},{keys:["o"],type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!0}},{keys:["O"],type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!1}},{keys:["v"],type:"action",action:"toggleVisualMode"},{keys:["V"],type:"action",action:"toggleVisualMode",actionArgs:{linewise:!0}},{keys:["g","v"],type:"action",action:"reselectLastSelection"},{keys:["J"],type:"action",action:"joinLines",isEdit:!0},{keys:["p"],type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0}},{keys:["P"],type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0}},{keys:["r","character"],type:"action",action:"replace",isEdit:!0},{keys:["@","character"],type:"action",action:"replayMacro"},{keys:["q","character"],type:"action",action:"enterMacroRecordMode"},{keys:["R"],type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{replace:!0}},{keys:["u"],type:"action",action:"undo"},{keys:["u"],type:"action",action:"changeCase",actionArgs:{toLower:!0},context:"visual",isEdit:!0},{keys:["U"],type:"action",action:"changeCase",actionArgs:{toLower:!1},context:"visual",isEdit:!0},{keys:["<C-r>"],type:"action",action:"redo"},{keys:["m","character"],type:"action",action:"setMark"},{keys:['"',"character"],type:"action",action:"setRegister"},{keys:["z","z"],type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:["z","."],type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:["z","t"],type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:["z","<CR>"],type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:["z","-"],type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:["z","b"],type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:["."],type:"action",action:"repeatLastEdit"},{keys:["<C-a>"],type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!0,backtrack:!1}},{keys:["<C-x>"],type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!1,backtrack:!1}},{keys:["a","character"],type:"motion",motion:"textObjectManipulation"},{keys:["i","character"],type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:!0}},{keys:["/"],type:"search",searchArgs:{forward:!0,querySrc:"prompt",toJumplist:!0}},{keys:["?"],type:"search",searchArgs:{forward:!1,querySrc:"prompt",toJumplist:!0}},{keys:["*"],type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:["#"],type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:["g","*"],type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:["g","#"],type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:[":"],type:"ex"}],c=a.Pos,d=function(){function e(a){var b=a.state.vim;return b.onPasteFn||(b.onPasteFn=function(){b.insertMode||(a.setCursor(A(a.getCursor(),0,1)),_a.enterInsertMode(a,{},b))}),b.onPasteFn}function f(a,b){for(var c=[],d=a;a+b>d;d++)c.push(String.fromCharCode(d));return c}function g(a,b){return b>=a.firstLine()&&b<=a.lastLine()}function h(a){return/^[a-z]$/.test(a)}function i(a){return-1!="()[]{}".indexOf(a)}function j(a){return Ja.test(a)}function k(a){return/^[A-Z]$/.test(a)}function l(a){return/^\s*$/.test(a)}function m(a,b){for(var c=0;c<b.length;c++)if(b[c]==a)return!0;return!1}function n(a,b,c){if(void 0===b)throw Error("defaultValue is required");c||(c="string"),Ta[a]={type:c,defaultValue:b},o(a,b)}function o(a,b){var c=Ta[a];if(!c)throw Error("Unknown option: "+a);if("boolean"==c.type){if(b&&b!==!0)throw Error("Invalid argument: "+a+"="+b);b!==!1&&(b=!0)}c.value="boolean"==c.type?!!b:b}function p(a){var b=Ta[a];if(!b)throw Error("Unknown option: "+a);return b.value}function q(){this.latestRegister=void 0,this.isPlaying=!1,this.isRecording=!1,this.replaySearchQueries=[],this.onRecordingDone=void 0,this.lastInsertModeChanges=Va()}function r(a){return a.state.vim||(a.state.vim={inputState:new t,lastEditInputState:void 0,lastEditActionCommand:void 0,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},fakeCursor:null,insertMode:!1,insertModeRepeat:void 0,visualMode:!1,visualLine:!1,lastSelection:null,lastPastedText:null}),a.state.vim}function s(){Wa={searchQuery:null,searchIsReversed:!1,lastSubstituteReplacePart:void 0,jumpList:Ua(),macroModeState:new q,lastChararacterSearch:{increment:0,forward:!0,selectedCharacter:""},registerController:new w({}),searchHistoryController:new x({}),exCommandHistoryController:new x({})};for(var a in Ta){var b=Ta[a];b.value=b.defaultValue}}function t(){this.prefixRepeat=[],this.motionRepeat=[],this.operator=null,this.operatorArgs=null,this.motion=null,this.motionArgs=null,this.keyBuffer=[],this.registerName=null}function u(b,c){b.state.vim.inputState=new t,a.signal(b,"vim-command-done",c)}function v(a,b){this.clear(),this.keyBuffer=[a||""],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!!b}function w(a){this.registers=a,this.unnamedRegister=a['"']=new v,a["."]=new v,a[":"]=new v,a["/"]=new v}function x(){this.historyBuffer=[],this.iterator,this.initialPrefix=null}function y(a,b,d){var e=Math.min(Math.max(a.firstLine(),b.line),a.lastLine()),f=H(a,e)-1;f=d?f+1:f;var g=Math.min(Math.max(0,b.ch),f);return c(e,g)}function z(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function A(a,b,d){return c(a.line+b,a.ch+d)}function B(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c]&&"character"!=b[c])return!1;return!0}function C(a,b,c){return function(){for(var d=0;c>d;d++)b(a)}}function D(a){return c(a.line,a.ch)}function E(a,b){return a.ch==b.ch&&a.line==b.line}function F(a,b){return a.line<b.line?!0:a.line==b.line&&a.ch<b.ch?!0:!1}function G(a,b,c){var d=F(a,b),e=F(b,c);return d&&e}function H(a,b){return a.getLine(b).length}function I(a){return a.split("").reverse().join("")}function J(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function K(a){return a.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1")}function L(a,b){var c=a.getCursor("anchor"),d=a.getCursor("head"),e=b.lastSelection;if(b.visualMode){if(F(d,c)){var f=c;c=d,d=f}N(a)}else{var g=b.lastSelection.curStartMark.find(),h=b.lastSelection.curEndMark.find(),i=h.line-g.line,j=i?h.ch:h.ch-g.ch;if(d={line:d.line+i,ch:i?d.ch:j+d.ch},e.visualLine)return[{line:c.line,ch:0},{line:d.line,ch:H(a,d.line)}]}return[c,d]}function M(a,b){var c=b.marks["<"].find()||a.getCursor("anchor"),d=b.marks[">"].find()||a.getCursor("head");b.lastPastedText&&(d=a.posFromIndex(a.indexFromPos(c)+b.lastPastedText.length-1),b.lastPastedText=null),b.lastSelection={curStartMark:a.setBookmark(c),curEndMark:a.setBookmark(d),visualMode:b.visualMode,visualLine:b.visualLine},F(d,c)&&(b.lastSelection.curStartMark=a.setBookmark(d),b.lastSelection.curEndMark=a.setBookmark(c))}function N(b){b.off("mousedown",N);var c=b.state.vim,d=b.getCursor("anchor"),e=b.getCursor("head");M(b,c),c.visualMode=!1,c.visualLine=!1,E(d,e)||b.setCursor(y(b,e)),a.signal(b,"vim-mode-change",{mode:"normal"}),c.fakeCursor&&c.fakeCursor.clear()}function O(a,b,c){var d=a.getRange(b,c);if(/\n\s*$/.test(d)){var e=d.split("\n");e.pop();for(var f,f=e.pop();e.length>0&&f&&l(f);f=e.pop())c.line--,c.ch=0;f?(c.line--,c.ch=H(a,c.line)):c.ch=0}}function P(a,b,c){b.ch=0,c.ch=0,c.line++}function Q(a){if(!a)return 0;var b=a.search(/\S/);return-1==b?a.length:b}function R(a,b,d,e,f){var g,h=a.getCursor(),i=a.getLine(h.line),j=h.ch,k=i.substring(j);if(g=f?k.search(/\w/):k.search(/\S/),-1==g)return null;j+=g,k=i.substring(j);var l,m=i.substring(0,j);l=e?/^\S+/:/\w/.test(i.charAt(j))?/^\w+/:/^[^\w\s]+/;var n=l.exec(k),o=j,p=j+n[0].length,q=I(m),r=l.exec(q);if(r&&(o-=r[0].length),b){var s=i.substring(p),t=s.match(/^\s*/)[0].length;if(t>0)p+=t;else{var u=q.length-o,v=q.substring(u),w=v.match(/^\s*/)[0].length;o-=w}}return{start:c(h.line,o),end:c(h.line,p)}}function S(a,b,c){E(b,c)||Wa.jumpList.add(a,b,c)}function T(a,b){Wa.lastChararacterSearch.increment=a,Wa.lastChararacterSearch.forward=b.forward,Wa.lastChararacterSearch.selectedCharacter=b.selectedCharacter}function U(a,b,d,e){var f=D(a.getCursor()),g=d?1:-1,h=d?a.lineCount():-1,i=f.ch,j=f.line,k=a.getLine(j),l={lineText:k,nextCh:k.charAt(i),lastCh:null,index:i,symb:e,reverseSymb:(d?{")":"(","}":"{"}:{"(":")","{":"}"})[e],forward:d,depth:0,curMoveThrough:!1},m=ab[e];if(!m)return f;var n=bb[m].init,o=bb[m].isComplete;for(n&&n(l);j!==h&&b;){if(l.index+=g,l.nextCh=l.lineText.charAt(l.index),!l.nextCh){if(j+=g,l.lineText=a.getLine(j)||"",g>0)l.index=0;else{var p=l.lineText.length;l.index=p>0?p-1:0}l.nextCh=l.lineText.charAt(l.index)}o(l)&&(f.line=j,f.ch=l.index,b--)}return l.nextCh||l.curMoveThrough?c(j,l.index):f}function V(a,b,c,d,e){var f=b.line,h=b.ch,i=a.getLine(f),j=c?1:-1,k=d?La:Ka;if(e&&""==i){if(f+=j,i=a.getLine(f),!g(a,f))return null;h=c?0:i.length}for(;;){if(e&&""==i)return{from:0,to:0,line:f};for(var l=j>0?i.length:-1,m=l,n=l;h!=l;){for(var o=!1,p=0;p<k.length&&!o;++p)if(k[p].test(i.charAt(h))){for(m=h;h!=l&&k[p].test(i.charAt(h));)h+=j;if(n=h,o=m!=n,m==b.ch&&f==b.line&&n==m+j)continue;return{from:Math.min(m,n+1),to:Math.max(m,n),line:f}}o||(h+=j)}if(f+=j,!g(a,f))return null;i=a.getLine(f),h=j>0?0:i.length}throw new Error("The impossible happened.")}function W(a,b,d,e,f){var g=a.getCursor(),h=D(g),i=[];(d&&!e||!d&&e)&&b++;for(var j=!(d&&e),k=0;b>k;k++){var l=V(a,g,d,f,j);if(!l){var m=H(a,a.lastLine());i.push(d?{line:a.lastLine(),from:m,to:m}:{line:0,from:0,to:0});break}i.push(l),g=c(l.line,d?l.to-1:l.from)}var n=i.length!=b,o=i[0],p=i.pop();return d&&!e?(n||o.from==h.ch&&o.line==h.line||(p=i.pop()),c(p.line,p.from)):d&&e?c(p.line,p.to-1):!d&&e?(n||o.to==h.ch&&o.line==h.line||(p=i.pop()),c(p.line,p.to)):c(p.line,p.from)}function X(a,b,d,e){for(var f,g=a.getCursor(),h=g.ch,i=0;b>i;i++){var j=a.getLine(g.line);if(f=$(h,j,e,d,!0),-1==f)return null;h=f}return c(a.getCursor().line,f)}function Y(a,b){var d=a.getCursor().line;return y(a,c(d,b-1))}function Z(a,b,c,d){m(c,Ra)&&(b.marks[c]&&b.marks[c].clear(),b.marks[c]=a.setBookmark(d))}function $(a,b,c,d,e){var f;return d?(f=b.indexOf(c,a+1),-1==f||e||(f-=1)):(f=b.lastIndexOf(c,a-1),-1==f||e||(f+=1)),f}function _(a,b,d){var e,f,g=a.getCursor(),h={"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/}[b],i={"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{"}[b],j=a.getLine(g.line).charAt(g.ch),k=j===i?1:0;if(e=a.scanForBracket(c(g.line,g.ch+k),-1,null,{bracketRegex:h}),f=a.scanForBracket(c(g.line,g.ch+k),1,null,{bracketRegex:h}),!e||!f)return{start:g,end:g};if(e=e.pos,f=f.pos,e.line==f.line&&e.ch>f.ch||e.line>f.line){var l=e;e=f,f=l}return d?f.ch+=1:e.ch+=1,{start:e,end:f}}function aa(a,b,d){var e,f,g,h,i=D(a.getCursor()),j=a.getLine(i.line),k=j.split(""),l=k.indexOf(b);if(i.ch<l?i.ch=l:l<i.ch&&k[i.ch]==b&&(f=i.ch,--i.ch),k[i.ch]!=b||f)for(g=i.ch;g>-1&&!e;g--)k[g]==b&&(e=g+1);else e=i.ch+1;if(e&&!f)for(g=e,h=k.length;h>g&&!f;g++)k[g]==b&&(f=g);return e&&f?(d&&(--e,++f),{start:c(i.line,e),end:c(i.line,f)}):{start:i,end:i}}function ba(){}function ca(a){var b=a.state.vim;return b.searchState_||(b.searchState_=new ba)}function da(a,b,c,d,e){a.openDialog?a.openDialog(b,d,{bottom:!0,value:e.value,onKeyDown:e.onKeyDown,onKeyUp:e.onKeyUp}):d(prompt(c,""))}function ea(a){var b=fa(a)||[];if(!b.length)return[];var c=[];if(0===b[0]){for(var d=0;d<b.length;d++)"number"==typeof b[d]&&c.push(a.substring(b[d]+1,b[d+1]));return c}}function fa(a){for(var b=!1,c=[],d=0;d<a.length;d++){var e=a.charAt(d);b||"/"!=e||c.push(d),b=!b&&"\\"==e}return c}function ga(a){for(var b="|(){",c="}",d=!1,e=[],f=-1;f<a.length;f++){var g=a.charAt(f)||"",h=a.charAt(f+1)||"",i=h&&-1!=b.indexOf(h);d?("\\"===g&&i||e.push(g),d=!1):"\\"===g?(d=!0,h&&-1!=c.indexOf(h)&&(i=!0),i&&"\\"!==h||e.push(g)):(e.push(g),i&&"\\"!==h&&e.push("\\"))}return e.join("")}function ha(a){for(var b=!1,c=[],d=-1;d<a.length;d++){var e=a.charAt(d)||"",f=a.charAt(d+1)||"";b?(c.push(e),b=!1):"\\"===e?(b=!0,j(f)||"$"===f?c.push("$"):"/"!==f&&"\\"!==f&&c.push("\\")):("$"===e&&c.push("$"),c.push(e),"/"===f&&c.push("\\"))}return c.join("")}function ia(b){for(var c=new a.StringStream(b),d=[];!c.eol();){for(;c.peek()&&"\\"!=c.peek();)d.push(c.next());c.match("\\/",!0)?d.push("/"):c.match("\\\\",!0)?d.push("\\"):d.push(c.next())}return d.join("")}function ja(a,b,c){var d=Wa.registerController.getRegister("/");if(d.setText(a),a instanceof RegExp)return a;var e,f,g=fa(a);if(g.length){e=a.substring(0,g[0]);var h=a.substring(g[0]);f=-1!=h.indexOf("i")}else e=a;if(!e)return null;p("pcre")||(e=ga(e)),c&&(b=/^[^A-Z]*$/.test(e));var i=new RegExp(e,b||f?"i":void 0);return i}function ka(a,b){a.openNotification?a.openNotification('<span style="color: red">'+b+"</span>",{bottom:!0,duration:5e3}):alert(b)}function la(a,b){var c="";return a&&(c+='<span style="font-family: monospace">'+a+"</span>"),c+='<input type="text"/> <span style="color: #888">',b&&(c+='<span style="color: #888">',c+=b,c+="</span>"),c}function ma(a,b){var c=(b.prefix||"")+" "+(b.desc||""),d=la(b.prefix,b.desc);da(a,d,c,b.onClose,b)}function na(a,b){if(a instanceof RegExp&&b instanceof RegExp){for(var c=["global","multiline","ignoreCase","source"],d=0;d<c.length;d++){var e=c[d];if(a[e]!==b[e])return!1}return!0}return!1}function oa(a,b,c,d){if(b){var e=ca(a),f=ja(b,!!c,!!d);if(f)return qa(a,f),na(f,e.getQuery())?f:(e.setQuery(f),f)}}function pa(a){if("^"==a.source.charAt(0))var b=!0;return{token:function(c){if(b&&!c.sol())return void c.skipToEnd();var d=c.match(a,!1);if(d)return 0==d[0].length?(c.next(),"searching"):c.sol()||(c.backUp(1),a.exec(c.next()+d[0]))?(c.match(a),"searching"):(c.next(),null);for(;!c.eol()&&(c.next(),!c.match(a,!1)););},query:a}}function qa(a,b){var c=ca(a).getOverlay();c&&b==c.query||(c&&a.removeOverlay(c),c=pa(b),a.addOverlay(c),ca(a).setOverlay(c))}function ra(a,b,d,e){return void 0===e&&(e=1),a.operation(function(){for(var f=a.getCursor(),g=a.getSearchCursor(d,f),h=0;e>h;h++){var i=g.find(b);if(0==h&&i&&E(g.from(),f)&&(i=g.find(b)),!i&&(g=a.getSearchCursor(d,b?c(a.lastLine()):c(a.firstLine(),0)),!g.find(b)))return}return g.from()})}function sa(a){a.removeOverlay(ca(a).getOverlay()),ca(a).setOverlay(null)}function ta(a,b,c){return"number"!=typeof a&&(a=a.line),b instanceof Array?m(a,b):c?a>=b&&c>=a:a==b}function ua(a){var b=a.getScrollInfo(),c=6,d=10,e=a.coordsChar({left:0,top:c+b.top},"local"),f=b.clientHeight-d+b.top,g=a.coordsChar({left:0,top:f},"local");return{top:e.line,bottom:g.line}}function va(a){for(var b,c,d=[];a&&(c=/<\w+-.+?>|<\w+>|./.exec(a),null!==c);)b=c[0],a=a.substring(c.index+b.length),d.push(b);return d}function wa(b,c,d,e,f,g,h,i,j){function k(){b.operation(function(){for(;!p;)l(),m();n()})}function l(){var a=b.getRange(g.from(),g.to()),c=a.replace(h,i);g.replace(c)}function m(){for(var a;a=g.findNext()&&ta(g.from(),e,f);)if(d||!q||g.from().line!=q.line)return b.scrollIntoView(g.from(),30),b.setSelection(g.from(),g.to()),q=g.from(),void(p=!1);p=!0}function n(a){if(a&&a(),b.focus(),q){b.setCursor(q);var c=b.state.vim;c.exMode=!1,c.lastHPos=c.lastHSPos=q.ch}j&&j()}function o(c,d,e){a.e_stop(c);var f=a.keyName(c);switch(f){case"Y":l(),m();break;case"N":m();break;case"A":var g=j;j=void 0,b.operation(k),j=g;break;case"L":l();case"Q":case"Esc":case"Ctrl-C":case"Ctrl-[":n(e)}p&&n(e)}b.state.vim.exMode=!0;var p=!1,q=g.from();return m(),p?void ka(b,"No matches for "+h.source):c?void ma(b,{prefix:"replace with <strong>"+i+"</strong> (y/n/a/q/l)",onKeyDown:o}):(k(),void(j&&j()))}function xa(){function b(a,b){var c=a;k(c)&&"Ctrl"==b&&(c=c.toLowerCase()),b&&(c=b.charAt(0)+"-"+c);var d={Enter:"CR",Backspace:"BS",Delete:"Del"}[c];return c=d?d:c,c=c.length>1?"<"+c+">":c}function c(b){return function(c){a.signal(c,"vim-keypress",b),a.Vim.handleKey(c,b)}}function d(a,d){for(var f=0;f<a.length;f++){var g=a[f];d||1!=g.length||(g="'"+g+"'");var h=b(a[f],d),i=d?d+"-"+g:g;e[i]=c(h)}}var e={nofallthrough:!0,style:"fat-cursor"};return d(Ma),d(Na),d(Ma,"Ctrl"),d(Pa),d(Pa,"Ctrl"),d(Oa),d(Oa,"Ctrl"),d(Qa),d(Qa,"Ctrl"),e}function ya(b){var c=b.state.vim,d=Wa.macroModeState,e=Wa.registerController.getRegister("."),f=d.isPlaying;f||(b.off("change",Da),a.off(b.getInputField(),"keydown",Ga)),!f&&c.insertModeRepeat>1&&(Ha(b,c,c.insertModeRepeat-1,!0),c.lastEditInputState.repeatOverride=c.insertModeRepeat),delete c.insertModeRepeat,c.insertMode=!1,b.setCursor(b.getCursor().line,b.getCursor().ch-1),b.setOption("keyMap","vim"),b.setOption("disableInput",!0),b.toggleOverwrite(!1),e.setText(d.lastInsertModeChanges.changes.join("")),a.signal(b,"vim-mode-change",{mode:"normal"}),d.isRecording&&Ba(d)}function za(b,c,d,e){var f=Wa.registerController.getRegister(e),g=f.keyBuffer,h=0;d.isPlaying=!0,d.replaySearchQueries=f.searchQueries.slice(0);for(var i=0;i<g.length;i++)for(var j,k,l=g[i];l;)if(j=/<\w+-.+?>|<\w+>|./.exec(l),k=j[0],l=l.substring(j.index+k.length),a.Vim.handleKey(b,k),c.insertMode){var m=f.insertModeChanges[h++].changes;Wa.macroModeState.lastInsertModeChanges.changes=m,Ia(b,m,1),ya(b)}d.isPlaying=!1}function Aa(a,b){if(!a.isPlaying){var c=a.latestRegister,d=Wa.registerController.getRegister(c);d&&d.pushText(b)}}function Ba(a){if(!a.isPlaying){var b=a.latestRegister,c=Wa.registerController.getRegister(b);c&&c.pushInsertModeChanges(a.lastInsertModeChanges)}}function Ca(a,b){if(!a.isPlaying){var c=a.latestRegister,d=Wa.registerController.getRegister(c);d&&d.pushSearchQuery(b)}}function Da(a,b){var c=Wa.macroModeState,d=c.lastInsertModeChanges;if(!c.isPlaying)for(;b;){if(d.expectCursorActivityForChange=!0,"+input"==b.origin||"paste"==b.origin||void 0===b.origin){var e=b.text.join("\n");d.changes.push(e)}b=b.next}}function Ea(a){var b=a.state.vim;if(b.insertMode){var d=Wa.macroModeState;if(d.isPlaying)return;var e=d.lastInsertModeChanges;e.expectCursorActivityForChange?e.expectCursorActivityForChange=!1:e.changes=[]}else"*mouse"==a.doc.history.lastSelOrigin&&(b.lastHPos=a.doc.getCursor().ch,a.somethingSelected()&&(b.visualMode=!0));if(b.visualMode){var f,g;f=g=a.getCursor("head");var h=a.getCursor("anchor"),i=c(g.line,f.ch+(F(h,g)?-1:1));if(F(i,f)){var j=f;f=i,i=j}b.fakeCursor&&b.fakeCursor.clear(),b.fakeCursor=a.markText(f,i,{className:"cm-animate-fat-cursor"})}}function Fa(a){this.keyName=a}function Ga(b){function c(){return e.changes.push(new Fa(f)),!0}var d=Wa.macroModeState,e=d.lastInsertModeChanges,f=a.keyName(b);(-1!=f.indexOf("Delete")||-1!=f.indexOf("Backspace"))&&a.lookupKey(f,["vim-insert"],c)}function Ha(a,b,c,d){function e(){h?Ya.processAction(a,b,b.lastEditActionCommand):Ya.evalInput(a,b)}function f(c){if(g.lastInsertModeChanges.changes.length>0){c=b.lastEditActionCommand?c:1;var d=g.lastInsertModeChanges;g.lastInsertModeChanges={},Ia(a,d.changes,c),g.lastInsertModeChanges=d}}var g=Wa.macroModeState;g.isPlaying=!0;var h=!!b.lastEditActionCommand,i=b.inputState;if(b.inputState=b.lastEditInputState,h&&b.lastEditActionCommand.interlaceInsertRepeat)for(var j=0;c>j;j++)e(),f(1);else d||e(),f(c);b.inputState=i,b.insertMode&&!d&&ya(a),g.isPlaying=!1}function Ia(b,c,d){function e(c){return"string"==typeof c?a.commands[c](b):c(b),!0}for(var f=0;d>f;f++)for(var g=0;g<c.length;g++){var h=c[g];if(h instanceof Fa)a.lookupKey(h.keyName,["vim-insert"],e);else{var i=b.getCursor();b.replaceRange(h,i,i)}}}a.defineOption("vimMode",!1,function(b,c){c?(b.setOption("keyMap","vim"),b.setOption("disableInput",!0),b.setOption("showCursorWhenSelecting",!1),a.signal(b,"vim-mode-change",{mode:"normal"}),b.on("cursorActivity",Ea),r(b),a.on(b.getInputField(),"paste",e(b))):b.state.vim&&(b.setOption("keyMap","default"),b.setOption("disableInput",!1),b.off("cursorActivity",Ea),a.off(b.getInputField(),"paste",e(b)),b.state.vim=null)});var Ja=/[\d]/,Ka=[/\w/,/[^\w\s]/],La=[/\S/],Ma=f(65,26),Na=f(97,26),Oa=f(48,10),Pa="~`!@#$%^&*()_-+=[{}]\\|/?.,<>:;\"'".split(""),Qa=["Left","Right","Up","Down","Space","Backspace","Esc","Home","End","PageUp","PageDown","Enter"],Ra=[].concat(Ma,Na,Oa,["<",">"]),Sa=[].concat(Ma,Na,Oa,["-",'"',".",":","/"]),Ta={},Ua=function(){function a(a,b,h){function i(b){var e=++d%c,f=g[e];f&&f.clear(),g[e]=a.setBookmark(b)}var j=d%c,k=g[j];if(k){var l=k.find();l&&!E(l,b)&&i(b)}else i(b);i(h),e=d,f=d-c+1,0>f&&(f=0)}function b(a,b){d+=b,d>e?d=e:f>d&&(d=f);var h=g[(c+d)%c];if(h&&!h.find()){var i,j=b>0?1:-1,k=a.getCursor();do if(d+=j,h=g[(c+d)%c],h&&(i=h.find())&&!E(k,i))break;while(e>d&&d>f)}return h}var c=100,d=-1,e=0,f=0,g=new Array(c);return{cachedCursor:void 0,add:a,move:b}},Va=function(a){return a?{changes:a.changes,expectCursorActivityForChange:a.expectCursorActivityForChange}:{changes:[],expectCursorActivityForChange:!1}};q.prototype={exitMacroRecordMode:function(){var a=Wa.macroModeState;a.onRecordingDone(),a.onRecordingDone=void 0,a.isRecording=!1},enterMacroRecordMode:function(a,b){var c=Wa.registerController.getRegister(b);c&&(c.clear(),this.latestRegister=b,this.onRecordingDone=a.openDialog("(recording)["+b+"]",null,{bottom:!0}),this.isRecording=!0)}};var Wa,Xa={buildKeyMap:function(){},getRegisterController:function(){return Wa.registerController},resetVimGlobalState_:s,getVimGlobalState_:function(){return Wa},maybeInitVimState_:r,InsertModeKey:Fa,map:function(a,b,c){fb.map(a,b,c)},setOption:o,getOption:p,defineOption:n,defineEx:function(a,b,c){if(0!==a.indexOf(b))throw new Error('(Vim.defineEx) "'+b+'" is not a prefix of "'+a+'", command not registered');eb[a]=c,fb.commandMap_[b]={name:a,shortName:b,type:"api"}},handleKey:function(c,d){var e,f=r(c),g=Wa.macroModeState;if(g.isRecording&&"q"==d)return g.exitMacroRecordMode(),void u(c);if("<Esc>"==d)return u(c),void(f.visualMode&&N(c));if(f.visualMode||E(c.getCursor("head"),c.getCursor("anchor"))||(f.visualMode=!0,f.visualLine=!1,a.signal(c,"vim-mode-change",{mode:"visual"}),c.on("mousedown",N)),("0"!=d||"0"==d&&0===f.inputState.getRepeat())&&(e=Ya.matchCommand(d,b,f)),!e)return j(d)&&f.inputState.pushRepeatDigit(d),void(g.isRecording&&Aa(g,d));if("keyToKey"==e.type)for(var h=0;h<e.toKeys.length;h++)this.handleKey(c,e.toKeys[h]);else g.isRecording&&Aa(g,d),Ya.processCommand(c,f,e)},handleEx:function(a,b){fb.processCommand(a,b)}};t.prototype.pushRepeatDigit=function(a){this.operator?this.motionRepeat=this.motionRepeat.concat(a):this.prefixRepeat=this.prefixRepeat.concat(a)},t.prototype.getRepeat=function(){var a=0;return(this.prefixRepeat.length>0||this.motionRepeat.length>0)&&(a=1,this.prefixRepeat.length>0&&(a*=parseInt(this.prefixRepeat.join(""),10)),this.motionRepeat.length>0&&(a*=parseInt(this.motionRepeat.join(""),10))),a},v.prototype={setText:function(a,b){this.keyBuffer=[a||""],this.linewise=!!b},pushText:function(a,b){b&&(this.linewise||this.keyBuffer.push("\n"),this.linewise=!0),this.keyBuffer.push(a)},pushInsertModeChanges:function(a){this.insertModeChanges.push(Va(a))},pushSearchQuery:function(a){this.searchQueries.push(a)},clear:function(){this.keyBuffer=[],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!1},toString:function(){return this.keyBuffer.join("")}},w.prototype={pushText:function(a,b,c,d){d&&"\n"==c.charAt(0)&&(c=c.slice(1)+"\n"),d&&"\n"!==c.charAt(c.length-1)&&(c+="\n");var e=this.isValidRegister(a)?this.getRegister(a):null;if(!e){switch(b){case"yank":this.registers[0]=new v(c,d);break;case"delete":case"change":-1==c.indexOf("\n")?this.registers["-"]=new v(c,d):(this.shiftNumericRegisters_(),this.registers[1]=new v(c,d))}return void this.unnamedRegister.setText(c,d)}var f=k(a);f?e.pushText(c,d):e.setText(c,d),this.unnamedRegister.setText(e.toString(),d)},getRegister:function(a){return this.isValidRegister(a)?(a=a.toLowerCase(),
this.registers[a]||(this.registers[a]=new v),this.registers[a]):this.unnamedRegister},isValidRegister:function(a){return a&&m(a,Sa)},shiftNumericRegisters_:function(){for(var a=9;a>=2;a--)this.registers[a]=this.getRegister(""+(a-1))}},x.prototype={nextMatch:function(a,b){var c=this.historyBuffer,d=b?-1:1;null===this.initialPrefix&&(this.initialPrefix=a);for(var e=this.iterator+d;b?e>=0:e<c.length;e+=d)for(var f=c[e],g=0;g<=f.length;g++)if(this.initialPrefix==f.substring(0,g))return this.iterator=e,f;return e>=c.length?(this.iterator=c.length,this.initialPrefix):0>e?a:void 0},pushInput:function(a){var b=this.historyBuffer.indexOf(a);b>-1&&this.historyBuffer.splice(b,1),a.length&&this.historyBuffer.push(a)},reset:function(){this.initialPrefix=null,this.iterator=this.historyBuffer.length}};var Ya={matchCommand:function(a,b,c){function d(b){return g.length<b.keys.length?(f.keyBuffer.push(a),null):("character"==b.keys[g.length-1]&&(f.selectedCharacter=e),f.keyBuffer=[],b)}for(var e,f=c.inputState,g=f.keyBuffer.concat(a),h=[],i=0;i<b.length;i++){var j=b[i];if(B(g,j.keys)){if(f.operator&&"action"==j.type)continue;if("character"==j.keys[g.length-1]&&(e=g[g.length-1],e.length>1))switch(e){case"<CR>":e="\n";break;case"<Space>":e=" ";break;default:continue}h.push(j)}}if(h.length){if(1==h.length)return d(h[0]);for(var k,l=c.visualMode?"visual":"normal",i=0;i<h.length;i++){var m=h[i];if(m.context==l){k=m;break}k||m.context||(k=m)}return d(k)}return f.keyBuffer=[],null},processCommand:function(a,b,c){switch(b.inputState.repeatOverride=c.repeatOverride,c.type){case"motion":this.processMotion(a,b,c);break;case"operator":this.processOperator(a,b,c);break;case"operatorMotion":this.processOperatorMotion(a,b,c);break;case"action":this.processAction(a,b,c);break;case"search":this.processSearch(a,b,c);break;case"ex":case"keyToEx":this.processEx(a,b,c)}},processMotion:function(a,b,c){b.inputState.motion=c.motion,b.inputState.motionArgs=z(c.motionArgs),this.evalInput(a,b)},processOperator:function(a,b,c){var d=b.inputState;if(d.operator){if(d.operator==c.operator)return d.motion="expandToLine",d.motionArgs={linewise:!0},void this.evalInput(a,b);u(a)}d.operator=c.operator,d.operatorArgs=z(c.operatorArgs),b.visualMode&&this.evalInput(a,b)},processOperatorMotion:function(a,b,c){var d=b.visualMode,e=z(c.operatorMotionArgs);e&&d&&e.visualLine&&(b.visualLine=!0),this.processOperator(a,b,c),d||this.processMotion(a,b,c)},processAction:function(a,b,c){var d=b.inputState,e=d.getRepeat(),f=!!e,g=z(c.actionArgs)||{};d.selectedCharacter&&(g.selectedCharacter=d.selectedCharacter),c.operator&&this.processOperator(a,b,c),c.motion&&this.processMotion(a,b,c),(c.motion||c.operator)&&this.evalInput(a,b),g.repeat=e||1,g.repeatIsExplicit=f,g.registerName=d.registerName,u(a),b.lastMotion=null,c.isEdit&&this.recordLastEdit(b,d,c),_a[c.action](a,g,b)},processSearch:function(b,c,d){function e(a,e,f){Wa.searchHistoryController.pushInput(a),Wa.searchHistoryController.reset();try{oa(b,a,e,f)}catch(g){return void ka(b,"Invalid regex: "+a)}Ya.processMotion(b,c,{type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:d.searchArgs.toJumplist}})}function f(a){b.scrollTo(m.left,m.top),e(a,!0,!0);var c=Wa.macroModeState;c.isRecording&&Ca(c,a)}function g(c,d,e){var f,g=a.keyName(c);"Up"==g||"Down"==g?(f="Up"==g?!0:!1,d=Wa.searchHistoryController.nextMatch(d,f)||"",e(d)):"Left"!=g&&"Right"!=g&&"Ctrl"!=g&&"Alt"!=g&&"Shift"!=g&&Wa.searchHistoryController.reset();var h;try{h=oa(b,d,!0,!0)}catch(c){}h?b.scrollIntoView(ra(b,!i,h),30):(sa(b),b.scrollTo(m.left,m.top))}function h(c,d,e){var f=a.keyName(c);("Esc"==f||"Ctrl-C"==f||"Ctrl-["==f)&&(Wa.searchHistoryController.pushInput(d),Wa.searchHistoryController.reset(),oa(b,l),sa(b),b.scrollTo(m.left,m.top),a.e_stop(c),e(),b.focus())}if(b.getSearchCursor){var i=d.searchArgs.forward,j=d.searchArgs.wholeWordOnly;ca(b).setReversed(!i);var k=i?"/":"?",l=ca(b).getQuery(),m=b.getScrollInfo();switch(d.searchArgs.querySrc){case"prompt":var n=Wa.macroModeState;if(n.isPlaying){var o=n.replaySearchQueries.shift();e(o,!0,!1)}else ma(b,{onClose:f,prefix:k,desc:cb,onKeyUp:g,onKeyDown:h});break;case"wordUnderCursor":var p=R(b,!1,!0,!1,!0),q=!0;if(p||(p=R(b,!1,!0,!1,!1),q=!1),!p)return;var o=b.getLine(p.start.line).substring(p.start.ch,p.end.ch);o=q&&j?"\\b"+o+"\\b":K(o),Wa.jumpList.cachedCursor=b.getCursor(),b.setCursor(p.start),e(o,!0,!1)}}},processEx:function(b,c,d){function e(a){Wa.exCommandHistoryController.pushInput(a),Wa.exCommandHistoryController.reset(),fb.processCommand(b,a)}function f(c,d,e){var f,g=a.keyName(c);("Esc"==g||"Ctrl-C"==g||"Ctrl-["==g)&&(Wa.exCommandHistoryController.pushInput(d),Wa.exCommandHistoryController.reset(),a.e_stop(c),e(),b.focus()),"Up"==g||"Down"==g?(f="Up"==g?!0:!1,d=Wa.exCommandHistoryController.nextMatch(d,f)||"",e(d)):"Left"!=g&&"Right"!=g&&"Ctrl"!=g&&"Alt"!=g&&"Shift"!=g&&Wa.exCommandHistoryController.reset()}"keyToEx"==d.type?fb.processCommand(b,d.exArgs.input):c.visualMode?ma(b,{onClose:e,prefix:":",value:"'<,'>",onKeyDown:f}):ma(b,{onClose:e,prefix:":",onKeyDown:f})},evalInput:function(a,b){var d,e,f=b.inputState,g=f.motion,h=f.motionArgs||{},i=f.operator,j=f.operatorArgs||{},k=f.registerName,l=D(a.getCursor("head")),m=D(a.getCursor("anchor")),n=D(l),o=D(n);if(i&&this.recordLastEdit(b,f),e=void 0!==f.repeatOverride?f.repeatOverride:f.getRepeat(),e>0&&h.explicitRepeat?h.repeatIsExplicit=!0:(h.noRepeat||!h.explicitRepeat&&0===e)&&(e=1,h.repeatIsExplicit=!1),f.selectedCharacter&&(h.selectedCharacter=j.selectedCharacter=f.selectedCharacter),h.repeat=e,u(a),g){var p=Za[g](a,h,b);if(b.lastMotion=Za[g],!p)return;if(h.toJumplist){var q=Wa.jumpList,r=q.cachedCursor;r?(S(a,r,p),delete q.cachedCursor):S(a,o,p)}if(p instanceof Array?(n=p[0],d=p[1]):d=p,d||(d=c(n.line,n.ch)),b.visualMode){if(F(m,l)&&(E(m,d)||F(d,m))?(m.ch+=1,d.ch-=1):F(l,m)&&(E(m,d)||F(m,d))&&(m.ch-=1,d.ch+=1),b.lastHPos!=1/0&&(b.lastHPos=d.ch),l=d,m=p instanceof Array?n:m,b.visualLine)if(F(m,l)){m.ch=0;var s=a.lastLine();l.line>s&&(l.line=s),l.ch=H(a,l.line)}else l.ch=0,m.ch=H(a,m.line);a.setSelection(m,l),Z(a,b,"<",F(m,l)?m:l),Z(a,b,">",F(m,l)?l:m)}else i||(d=y(a,d),a.setCursor(d.line,d.ch))}if(i){var t=!1;if(b.lastMotion=null,j.repeat=e,b.visualMode&&(n=m,d=l,h.inclusive=!0),d&&F(d,n)){var v=n;n=d,d=v,t=!0}else d||(d=D(n));if(h.inclusive&&!b.visualMode&&d.ch++,j.selOffset)d.line=n.line+j.selOffset.line,j.selOffset.line?d.ch=j.selOffset.ch:d.ch=n.ch+j.selOffset.ch;else if(b.visualMode){var w=c();w.line=d.line-n.line,w.line?w.ch=d.ch:w.ch=d.ch-n.ch,j.selOffset=w}var x=h.linewise||b.visualMode&&b.visualLine||j.linewise;x?P(a,n,d):h.forward&&O(a,n,d),j.registerName=k,j.linewise=x,$a[i](a,j,b,n,d,o),b.visualMode&&N(a)}},recordLastEdit:function(a,b,c){var d=Wa.macroModeState;d.isPlaying||(a.lastEditInputState=b,a.lastEditActionCommand=c,d.lastInsertModeChanges.changes=[],d.lastInsertModeChanges.expectCursorActivityForChange=!1)}},Za={moveToTopLine:function(a,b){var d=ua(a).top+b.repeat-1;return c(d,Q(a.getLine(d)))},moveToMiddleLine:function(a){var b=ua(a),d=Math.floor(.5*(b.top+b.bottom));return c(d,Q(a.getLine(d)))},moveToBottomLine:function(a,b){var d=ua(a).bottom-b.repeat+1;return c(d,Q(a.getLine(d)))},expandToLine:function(a,b){var d=a.getCursor();return c(d.line+b.repeat-1,1/0)},findNext:function(a,b){var c=ca(a),d=c.getQuery();if(d){var e=!b.forward;return e=c.isReversed()?!e:e,qa(a,d),ra(a,e,d,b.repeat)}},goToMark:function(a,b,c){var d=c.marks[b.selectedCharacter];if(d){var e=d.find();return b.linewise?{line:e.line,ch:Q(a.getLine(e.line))}:e}return null},moveToOtherHighlightedEnd:function(a){var b=D(a.getCursor("head")),c=D(a.getCursor("anchor"));return F(c,b)?b.ch+=1:F(b,c)&&(c.ch-=1),[b,c]},jumpToMark:function(a,b,d){for(var e=a.getCursor(),f=0;f<b.repeat;f++){var g=e;for(var i in d.marks)if(h(i)){var j=d.marks[i].find(),k=b.forward?F(j,g):F(g,j);if(!(k||b.linewise&&j.line==g.line)){var l=E(g,e),m=b.forward?G(g,j,e):G(e,j,g);(l||m)&&(e=j)}}}return b.linewise&&(e=c(e.line,Q(a.getLine(e.line)))),e},moveByCharacters:function(a,b){var d=a.getCursor(),e=b.repeat,f=b.forward?d.ch+e:d.ch-e;return c(d.line,f)},moveByLines:function(a,b,d){var e=a.getCursor(),f=e.ch;switch(d.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:f=d.lastHPos;break;default:d.lastHPos=f}var g=b.repeat+(b.repeatOffset||0),h=b.forward?e.line+g:e.line-g,i=a.firstLine(),j=a.lastLine();return i>h&&e.line==i||h>j&&e.line==j?void 0:(b.toFirstChar&&(f=Q(a.getLine(h)),d.lastHPos=f),d.lastHSPos=a.charCoords(c(h,f),"div").left,c(h,f))},moveByDisplayLines:function(a,b,d){var e=a.getCursor();switch(d.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:d.lastHSPos=a.charCoords(e,"div").left}var f=b.repeat,g=a.findPosV(e,b.forward?f:-f,"line",d.lastHSPos);if(g.hitSide)if(b.forward)var h=a.charCoords(g,"div"),i={top:h.top+8,left:d.lastHSPos},g=a.coordsChar(i,"div");else{var j=a.charCoords(c(a.firstLine(),0),"div");j.left=d.lastHSPos,g=a.coordsChar(j,"div")}return d.lastHPos=g.ch,g},moveByPage:function(a,b){var c=a.getCursor(),d=b.repeat;return a.findPosV(c,b.forward?d:-d,"page")},moveByParagraph:function(a,b){for(var d=a.getCursor().line,e=b.repeat,f=b.forward?1:-1,g=0;e>g&&!(!b.forward&&d===a.firstLine()||b.forward&&d==a.lastLine());g++)for(d+=f;d!==a.firstLine()&&d!=a.lastLine()&&a.getLine(d);)d+=f;return c(d,0)},moveByScroll:function(a,b,c){var d=a.getScrollInfo(),e=null,f=b.repeat;f||(f=d.clientHeight/(2*a.defaultTextHeight()));var g=a.charCoords(a.getCursor(),"local");b.repeat=f;var e=Za.moveByDisplayLines(a,b,c);if(!e)return null;var h=a.charCoords(e,"local");return a.scrollTo(null,d.top+h.top-g.top),e},moveByWords:function(a,b){return W(a,b.repeat,!!b.forward,!!b.wordEnd,!!b.bigWord)},moveTillCharacter:function(a,b){var c=b.repeat,d=X(a,c,b.forward,b.selectedCharacter),e=b.forward?-1:1;return T(e,b),d?(d.ch+=e,d):null},moveToCharacter:function(a,b){var c=b.repeat;return T(0,b),X(a,c,b.forward,b.selectedCharacter)||a.getCursor()},moveToSymbol:function(a,b){var c=b.repeat;return U(a,c,b.forward,b.selectedCharacter)||a.getCursor()},moveToColumn:function(a,b,c){var d=b.repeat;return c.lastHPos=d-1,c.lastHSPos=a.charCoords(a.getCursor(),"div").left,Y(a,d)},moveToEol:function(a,b,d){var e=a.getCursor();d.lastHPos=1/0;var f=c(e.line+b.repeat-1,1/0),g=a.clipPos(f);return g.ch--,d.lastHSPos=a.charCoords(g,"div").left,f},moveToFirstNonWhiteSpaceCharacter:function(a){var b=a.getCursor();return c(b.line,Q(a.getLine(b.line)))},moveToMatchedSymbol:function(a){var b,d=a.getCursor(),e=d.line,f=d.ch,g=a.getLine(e);do if(b=g.charAt(f++),b&&i(b)){var h=a.getTokenTypeAt(c(e,f));if("string"!==h&&"comment"!==h)break}while(b);if(b){var j=a.findMatchingBracket(c(e,f));return j.to}return d},moveToStartOfLine:function(a){var b=a.getCursor();return c(b.line,0)},moveToLineOrEdgeOfDocument:function(a,b){var d=b.forward?a.lastLine():a.firstLine();return b.repeatIsExplicit&&(d=b.repeat-a.getOption("firstLineNumber")),c(d,Q(a.getLine(d)))},textObjectManipulation:function(a,b){var c={"(":")",")":"(","{":"}","}":"{","[":"]","]":"["},d={"'":!0,'"':!0},e=b.selectedCharacter;"b"==e?e="(":"B"==e&&(e="{");var f,g=!b.textObjectInner;if(c[e])f=_(a,e,g);else if(d[e])f=aa(a,e,g);else if("W"===e)f=R(a,g,!0,!0);else{if("w"!==e)return null;f=R(a,g,!0,!1)}return[f.start,f.end]},repeatLastCharacterSearch:function(a,b){var c=Wa.lastChararacterSearch,d=b.repeat,e=b.forward===c.forward,f=(c.increment?1:0)*(e?-1:1);a.moveH(-f,"char"),b.inclusive=e?!0:!1;var g=X(a,d,e,c.selectedCharacter);return g?(g.ch+=f,g):(a.moveH(f,"char"),a.getCursor())}},$a={change:function(a,b,c,d,e){if(Wa.registerController.pushText(b.registerName,"change",a.getRange(d,e),b.linewise),b.linewise){var f=e.line>a.lastLine()?"":"\n";a.replaceRange(f,d,e),a.indentLine(d.line,"smart"),d.ch=null}else{var g=a.getRange(d,e);if(!l(g)){var h=/\s+$/.exec(g);h&&(e=A(e,0,-h[0].length))}a.replaceRange("",d,e)}_a.enterInsertMode(a,{},a.state.vim),a.setCursor(d)},"delete":function(a,b,c,d,e){b.linewise&&e.line>a.lastLine()&&d.line>a.firstLine()&&(d.line--,d.ch=H(a,d.line)),Wa.registerController.pushText(b.registerName,"delete",a.getRange(d,e),b.linewise),a.replaceRange("",d,e),b.linewise?a.setCursor(Za.moveToFirstNonWhiteSpaceCharacter(a)):a.setCursor(d)},indent:function(a,b,c,d,e){var f=d.line,g=e.line,h=c.visualMode?b.repeat:1;b.linewise&&g--;for(var i=f;g>=i;i++)for(var j=0;h>j;j++)a.indentLine(i,b.indentRight);a.setCursor(d),a.setCursor(Za.moveToFirstNonWhiteSpaceCharacter(a))},swapcase:function(a,b,c,d,e,f){for(var g=a.getRange(d,e),h="",i=0;i<g.length;i++){var j=g.charAt(i);h+=k(j)?j.toLowerCase():j.toUpperCase()}a.replaceRange(h,d,e),b.shouldMoveCursor||a.setCursor(f)},yank:function(a,b,c,d,e,f){Wa.registerController.pushText(b.registerName,"yank",a.getRange(d,e),b.linewise),a.setCursor(f)}},_a={jumpListWalk:function(a,b,c){if(!c.visualMode){var d=b.repeat,e=b.forward,f=Wa.jumpList,g=f.move(a,e?d:-d),h=g?g.find():void 0;h=h?h:a.getCursor(),a.setCursor(h)}},scroll:function(a,b,c){if(!c.visualMode){var d=b.repeat||1,e=a.defaultTextHeight(),f=a.getScrollInfo().top,g=e*d,h=b.forward?f+g:f-g,i=D(a.getCursor()),j=a.charCoords(i,"local");if(b.forward)h>j.top?(i.line+=(h-j.top)/e,i.line=Math.ceil(i.line),a.setCursor(i),j=a.charCoords(i,"local"),a.scrollTo(null,j.top)):a.scrollTo(null,h);else{var k=h+a.getScrollInfo().clientHeight;k<j.bottom?(i.line-=(j.bottom-k)/e,i.line=Math.floor(i.line),a.setCursor(i),j=a.charCoords(i,"local"),a.scrollTo(null,j.bottom-a.getScrollInfo().clientHeight)):a.scrollTo(null,h)}}},scrollToCursor:function(a,b){var d=a.getCursor().line,e=a.charCoords(c(d,0),"local"),f=a.getScrollInfo().clientHeight,g=e.top,h=e.bottom-g;switch(b.position){case"center":g=g-f/2+h;break;case"bottom":g=g-f+1.4*h;break;case"top":g+=.4*h}a.scrollTo(null,g)},replayMacro:function(a,b,c){var d=b.selectedCharacter,e=b.repeat,f=Wa.macroModeState;for("@"==d&&(d=f.latestRegister);e--;)za(a,c,f,d)},enterMacroRecordMode:function(a,b){var c=Wa.macroModeState,d=b.selectedCharacter;c.enterMacroRecordMode(a,d)},enterInsertMode:function(b,d,e){if(!b.getOption("readOnly")){e.insertMode=!0,e.insertModeRepeat=d&&d.repeat||1;var f=d?d.insertAt:null;if("eol"==f){var g=b.getCursor();g=c(g.line,H(b,g.line)),b.setCursor(g)}else if("charAfter"==f)b.setCursor(A(b.getCursor(),0,1));else if("firstNonBlank"==f)b.setCursor(Za.moveToFirstNonWhiteSpaceCharacter(b));else if("endOfSelectedArea"==f){var h=b.getCursor("head"),i=b.getCursor("anchor");h.line<i.line&&(h=c(i.line,0)),b.setCursor(h),N(b)}b.setOption("keyMap","vim-insert"),b.setOption("disableInput",!1),d&&d.replace?(b.toggleOverwrite(!0),b.setOption("keyMap","vim-replace"),a.signal(b,"vim-mode-change",{mode:"replace"})):(b.setOption("keyMap","vim-insert"),a.signal(b,"vim-mode-change",{mode:"insert"})),Wa.macroModeState.isPlaying||(b.on("change",Da),a.on(b.getInputField(),"keydown",Ga))}},toggleVisualMode:function(b,d,e){var f,g=d.repeat,h=b.getCursor();e.visualMode?(h=b.getCursor("anchor"),f=b.getCursor("head"),!e.visualLine&&d.linewise?(e.visualLine=!0,h.ch=F(h,f)?0:H(b,h.line),f.ch=F(h,f)?H(b,f.line):0,b.setSelection(h,f),a.signal(b,"vim-mode-change",{mode:"visual",subMode:"linewise"})):e.visualLine&&!d.linewise?(e.visualLine=!1,a.signal(b,"vim-mode-change",{mode:"visual"})):N(b)):(b.on("mousedown",N),e.visualMode=!0,e.visualLine=!!d.linewise,e.visualLine?(h.ch=0,f=y(b,c(h.line+g-1,H(b,h.line)),!0)):f=y(b,c(h.line,h.ch+g),!0),b.setSelection(h,f),a.signal(b,"vim-mode-change",{mode:"visual",subMode:e.visualLine?"linewise":""})),Z(b,e,"<",F(h,f)?h:f),Z(b,e,">",F(h,f)?f:h)},reselectLastSelection:function(b,c,d){var e=d.lastSelection;if(e){var f=e.curStartMark.find(),g=e.curEndMark.find();if(b.setSelection(f,g),d.visualMode){M(b,d);var h=b.getCursor("anchor"),i=b.getCursor("head");Z(b,d,"<",F(h,i)?h:i),Z(b,d,">",F(h,i)?i:h)}e.visualLine?(d.visualMode=!0,d.visualLine=!0):(d.visualMode=!0,d.visualLine=!1),a.signal(b,"vim-mode-change",{mode:"visual",subMode:d.visualLine?"linewise":""})}},joinLines:function(a,b,d){var e,f;if(d.visualMode)e=a.getCursor("anchor"),f=a.getCursor("head"),f.ch=H(a,f.line)-1;else{var g=Math.max(b.repeat,2);e=a.getCursor(),f=y(a,c(e.line+g-1,1/0))}var h=0;a.operation(function(){for(var b=e.line;b<f.line;b++){h=H(a,e.line);var d=c(e.line+1,H(a,e.line+1)),g=a.getRange(e,d);g=g.replace(/\n\s*/g," "),a.replaceRange(g,e,d)}var i=c(e.line,h);a.setCursor(i)})},newLineAndEnterInsertMode:function(b,d,e){e.insertMode=!0;var f=D(b.getCursor());if(f.line!==b.firstLine()||d.after){f.line=d.after?f.line:f.line-1,f.ch=H(b,f.line),b.setCursor(f);var g=a.commands.newlineAndIndentContinueComment||a.commands.newlineAndIndent;g(b)}else b.replaceRange("\n",c(b.firstLine(),0)),b.setCursor(b.firstLine(),0);this.enterInsertMode(b,{repeat:d.repeat},e)},paste:function(a,b,d){var e=D(a.getCursor()),f=Wa.registerController.getRegister(b.registerName),g=f.toString();if(g){if(b.matchIndent){var h=function(b){var c=b.split("	").length-1,d=b.split(" ").length-1;return c*a.options.tabSize+1*d},i=a.getLine(a.getCursor().line),j=h(i.match(/^\s*/)[0]),k=g.replace(/\n$/,""),l=g!==k,m=h(g.match(/^\s*/)[0]),g=k.replace(/^\s*/gm,function(b){var c=j+(h(b)-m);if(0>c)return"";if(a.options.indentWithTabs){var d=Math.floor(c/a.options.tabSize);return Array(d+1).join("	")}return Array(c+1).join(" ")});g+=l?"\n":""}if(b.repeat>1)var g=Array(b.repeat+1).join(g);var n=f.linewise;n?d.visualMode?g=d.visualLine?g.slice(0,-1):"\n"+g.slice(0,g.length-1)+"\n":b.after?(g="\n"+g.slice(0,g.length-1),e.ch=H(a,e.line)):e.ch=0:e.ch+=b.after?1:0;var o,p;if(d.visualMode){d.lastPastedText=g;var q,r=L(a,d),s=r[0],t=r[1];d.lastSelection&&(q=d.lastSelection.curEndMark.find()),Wa.registerController.unnamedRegister.setText(a.getRange(s,t)),a.replaceRange(g,s,t),q&&(d.lastSelection.curEndMark=a.setBookmark(q)),o=a.posFromIndex(a.indexFromPos(s)+g.length-1),n&&(o.ch=0)}else a.replaceRange(g,e),n&&b.after?o=c(e.line+1,Q(a.getLine(e.line+1))):n&&!b.after?o=c(e.line,Q(a.getLine(e.line))):!n&&b.after?(p=a.indexFromPos(e),o=a.posFromIndex(p+g.length-1)):(p=a.indexFromPos(e),o=a.posFromIndex(p+g.length));a.setCursor(o)}},undo:function(b,c){b.operation(function(){C(b,a.commands.undo,c.repeat)(),b.setCursor(b.getCursor("anchor"))})},redo:function(b,c){C(b,a.commands.redo,c.repeat)()},setRegister:function(a,b,c){c.inputState.registerName=b.selectedCharacter},setMark:function(a,b,c){var d=b.selectedCharacter;Z(a,c,d,a.getCursor())},replace:function(b,d,e){var f,g,h=d.selectedCharacter,i=b.getCursor();if(e.visualMode)i=b.getCursor("start"),g=b.getCursor("end");else{var j=b.getLine(i.line);f=i.ch+d.repeat,f>j.length&&(f=j.length),g=c(i.line,f)}if("\n"==h)e.visualMode||b.replaceRange("",i,g),(a.commands.newlineAndIndentContinueComment||a.commands.newlineAndIndent)(b);else{var k=b.getRange(i,g);k=k.replace(/[^\n]/g,h),b.replaceRange(k,i,g),e.visualMode?(b.setCursor(i),N(b)):b.setCursor(A(g,0,-1))}},incrementNumberToken:function(a,b){for(var d,e,f,g,h,i=a.getCursor(),j=a.getLine(i.line),k=/-?\d+/g;null!==(d=k.exec(j))&&(h=d[0],e=d.index,f=e+h.length,!(i.ch<f)););if((b.backtrack||!(f<=i.ch))&&h){var l=b.increase?1:-1,m=parseInt(h)+l*b.repeat,n=c(i.line,e),o=c(i.line,f);g=m.toString(),a.replaceRange(g,n,o),a.setCursor(c(i.line,e+g.length-1))}},repeatLastEdit:function(a,b,c){var d=c.lastEditInputState;if(d){var e=b.repeat;e&&b.repeatIsExplicit?c.lastEditInputState.repeatOverride=e:e=c.lastEditInputState.repeatOverride||e,Ha(a,c,e,!1)}},changeCase:function(a,b,c){var d=L(a,c),e=d[0],f=d[1],g=c.lastSelection.curEndMark.find(),h=b.toLower,i=a.getRange(e,f);a.replaceRange(h?i.toLowerCase():i.toUpperCase(),e,f),c.lastSelection.curEndMark=a.setBookmark(g),a.setCursor(e)}},ab={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"},bb={bracket:{isComplete:function(a){if(a.nextCh===a.symb){if(a.depth++,a.depth>=1)return!0}else a.nextCh===a.reverseSymb&&a.depth--;return!1}},section:{init:function(a){a.curMoveThrough=!0,a.symb=(a.forward?"]":"[")===a.symb?"{":"}"},isComplete:function(a){return 0===a.index&&a.nextCh===a.symb}},comment:{isComplete:function(a){var b="*"===a.lastCh&&"/"===a.nextCh;return a.lastCh=a.nextCh,b}},method:{init:function(a){a.symb="m"===a.symb?"{":"}",a.reverseSymb="{"===a.symb?"}":"{"},isComplete:function(a){return a.nextCh===a.symb?!0:!1}},preprocess:{init:function(a){a.index=0},isComplete:function(a){if("#"===a.nextCh){var b=a.lineText.match(/#(\w+)/)[1];if("endif"===b){if(a.forward&&0===a.depth)return!0;a.depth++}else if("if"===b){if(!a.forward&&0===a.depth)return!0;a.depth--}if("else"===b&&0===a.depth)return!0}return!1}}};n("pcre",!0,"boolean"),ba.prototype={getQuery:function(){return Wa.query},setQuery:function(a){Wa.query=a},getOverlay:function(){return this.searchOverlay},setOverlay:function(a){this.searchOverlay=a},isReversed:function(){return Wa.isReversed},setReversed:function(a){Wa.isReversed=a}};var cb="(Javascript regexp)",db=[{name:"map"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"unmap"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"set"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s",possiblyAsync:!0},{name:"nohlsearch",shortName:"noh"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:!0},{name:"global",shortName:"g"}];d.ExCommandDispatcher=function(){this.buildCommandMap_()},d.ExCommandDispatcher.prototype={processCommand:function(b,c,d){var e=b.state.vim,f=Wa.registerController.getRegister(":"),g=f.toString();e.visualMode&&N(b);var h=new a.StringStream(c);f.setText(c);var i=d||{};i.input=c;try{this.parseInput_(b,h,i)}catch(j){throw ka(b,j),j}var k,l;if(i.commandName){if(k=this.matchCommand_(i.commandName)){if(l=k.name,k.excludeFromCommandHistory&&f.setText(g),this.parseCommandArgs_(h,i,k),"exToKey"==k.type){for(var m=0;m<k.toKeys.length;m++)a.Vim.handleKey(b,k.toKeys[m]);return}if("exToEx"==k.type)return void this.processCommand(b,k.toInput)}}else void 0!==i.line&&(l="move");if(!l)return void ka(b,'Not an editor command ":'+c+'"');try{eb[l](b,i),k&&k.possiblyAsync||!i.callback||i.callback()}catch(j){throw ka(b,j),j}},parseInput_:function(a,b,c){b.eatWhile(":"),b.eat("%")?(c.line=a.firstLine(),c.lineEnd=a.lastLine()):(c.line=this.parseLineSpec_(a,b),void 0!==c.line&&b.eat(",")&&(c.lineEnd=this.parseLineSpec_(a,b)));var d=b.match(/^(\w+)/);return d?c.commandName=d[1]:c.commandName=b.match(/.*/)[0],c},parseLineSpec_:function(a,b){var c=b.match(/^(\d+)/);if(c)return parseInt(c[1],10)-1;switch(b.next()){case".":return a.getCursor().line;case"$":return a.lastLine();case"'":var d=a.state.vim.marks[b.next()];if(d&&d.find())return d.find().line;throw new Error("Mark not set");default:return void b.backUp(1)}},parseCommandArgs_:function(a,b,c){if(!a.eol()){b.argString=a.match(/.*/)[0];var d=c.argDelimiter||/\s+/,e=J(b.argString).split(d);e.length&&e[0]&&(b.args=e)}},matchCommand_:function(a){for(var b=a.length;b>0;b--){var c=a.substring(0,b);if(this.commandMap_[c]){var d=this.commandMap_[c];if(0===d.name.indexOf(a))return d}}return null},buildCommandMap_:function(){this.commandMap_={};for(var a=0;a<db.length;a++){var b=db[a],c=b.shortName||b.name;this.commandMap_[c]=b}},map:function(a,c,d){if(":"!=a&&":"==a.charAt(0)){if(d)throw Error("Mode not supported for ex mappings");var e=a.substring(1);":"!=c&&":"==c.charAt(0)?this.commandMap_[e]={name:e,type:"exToEx",toInput:c.substring(1),user:!0}:this.commandMap_[e]={name:e,type:"exToKey",toKeys:va(c),user:!0}}else if(":"!=c&&":"==c.charAt(0)){var f={keys:va(a),type:"keyToEx",exArgs:{input:c.substring(1)},user:!0};d&&(f.context=d),b.unshift(f)}else{var f={keys:va(a),type:"keyToKey",toKeys:va(c),user:!0};d&&(f.context=d),b.unshift(f)}},unmap:function(a,c){var d=function(a,b){if(a===b)return!0;if(null==a||null==b)return!0;if(a.length!=b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0};if(":"!=a&&":"==a.charAt(0)){if(c)throw Error("Mode not supported for ex mappings");var e=a.substring(1);if(this.commandMap_[e]&&this.commandMap_[e].user)return void delete this.commandMap_[e]}else for(var f=va(a),g=0;g<b.length;g++)if(d(f,b[g].keys)&&b[g].context===c&&b[g].user)return void b.splice(g,1);throw Error("No such mapping.")}};var eb={map:function(a,b,c){var d=b.args;return!d||d.length<2?void(a&&ka(a,"Invalid mapping: "+b.input)):void fb.map(d[0],d[1],c)},nmap:function(a,b){this.map(a,b,"normal")},vmap:function(a,b){this.map(a,b,"visual")},unmap:function(a,b,c){var d=b.args;return!d||d.length<1?void(a&&ka(a,"No such mapping: "+b.input)):void fb.unmap(d[0],c)},move:function(a,b){Ya.processCommand(a,a.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0},repeatOverride:b.line+1})},set:function(a,b){var c=b.args;if(!c||c.length<1)return void(a&&ka(a,"Invalid mapping: "+b.input));var d=c[0].split("="),e=d[0],f=d[1],g=!1;if("?"==e.charAt(e.length-1)){if(f)throw Error("Trailing characters: "+b.argString);e=e.substring(0,e.length-1),g=!0}void 0===f&&"no"==e.substring(0,2)&&(e=e.substring(2),f=!1);var h=Ta[e]&&"boolean"==Ta[e].type;if(h&&void 0==f&&(f=!0),!h&&!f||g){var i=p(e);i===!0||i===!1?ka(a," "+(i?"":"no")+e):ka(a,"  "+e+"="+i)}else o(e,f)},registers:function(a,b){var c=b.args,d=Wa.registerController.registers,e="----------Registers----------<br><br>";if(c){var f;c=c.join("");for(var g=0;g<c.length;g++)if(f=c.charAt(g),Wa.registerController.isValidRegister(f)){var h=d[f]||new v;e+='"'+f+"    "+h.toString()+"<br>"}}else for(var f in d){var i=d[f].toString();i.length&&(e+='"'+f+"    "+i+"<br>")}ka(a,e)},sort:function(b,d){function e(){if(d.argString){var b=new a.StringStream(d.argString);if(b.eat("!")&&(g=!0),b.eol())return;if(!b.eatSpace())return"Invalid arguments";var c=b.match(/[a-z]+/);if(c){c=c[0],h=-1!=c.indexOf("i"),i=-1!=c.indexOf("u");var e=-1!=c.indexOf("d")&&1,f=-1!=c.indexOf("x")&&1,k=-1!=c.indexOf("o")&&1;if(e+f+k>1)return"Invalid arguments";j=e&&"decimal"||f&&"hex"||k&&"octal"}b.eatSpace()&&b.match(/\/.*\//)}}function f(a,b){if(g){var c;c=a,a=b,b=c}h&&(a=a.toLowerCase(),b=b.toLowerCase());var d=j&&q.exec(a),e=j&&q.exec(b);return d?(d=parseInt((d[1]+d[2]).toLowerCase(),r),e=parseInt((e[1]+e[2]).toLowerCase(),r),d-e):b>a?-1:1}var g,h,i,j,k=e();if(k)return void ka(b,k+": "+d.argString);var l=d.line||b.firstLine(),m=d.lineEnd||d.line||b.lastLine();if(l!=m){var n=c(l,0),o=c(m,H(b,m)),p=b.getRange(n,o).split("\n"),q="decimal"==j?/(-?)([\d]+)/:"hex"==j?/(-?)(?:0x)?([0-9a-f]+)/i:"octal"==j?/([0-7]+)/:null,r="decimal"==j?10:"hex"==j?16:"octal"==j?8:null,s=[],t=[];if(j)for(var u=0;u<p.length;u++)q.exec(p[u])?s.push(p[u]):t.push(p[u]);else t=p;if(s.sort(f),t.sort(f),p=g?s.concat(t):t.concat(s),i){var v,w=p;p=[];for(var u=0;u<w.length;u++)w[u]!=v&&p.push(w[u]),v=w[u]}b.replaceRange(p.join("\n"),n,o)}},global:function(a,b){var c=b.argString;if(!c)return void ka(a,"Regular Expression missing from global");var d,e=void 0!==b.line?b.line:a.firstLine(),f=b.lineEnd||b.line||a.lastLine(),g=ea(c),h=c;if(g.length&&(h=g[0],d=g.slice(1,g.length).join("/")),h)try{oa(a,h,!0,!0)}catch(i){return void ka(a,"Invalid regex: "+h)}for(var j=ca(a).getQuery(),k=[],l="",m=e;f>=m;m++){var n=j.test(a.getLine(m));n&&(k.push(m+1),l+=a.getLine(m)+"<br>")}if(!d)return void ka(a,l);var o=0,p=function(){if(o<k.length){var b=k[o]+d;fb.processCommand(a,b,{callback:p})}o++};p()},substitute:function(a,b){if(!a.getSearchCursor)throw new Error("Search feature not available. Requires searchcursor.js or any other getSearchCursor implementation.");var d,e,f,g,h=b.argString,i=h?ea(h):[],j="",k=!1,l=!1;if(i.length)d=i[0],j=i[1],void 0!==j&&(j=p("pcre")?ia(j):ha(j),Wa.lastSubstituteReplacePart=j),e=i[2]?i[2].split(" "):[];else if(h&&h.length)return void ka(a,"Substitutions should be of the form :s/pattern/replace/");if(e&&(f=e[0],g=parseInt(e[1]),f&&(-1!=f.indexOf("c")&&(k=!0,f.replace("c","")),-1!=f.indexOf("g")&&(l=!0,f.replace("g","")),d=d+"/"+f)),d)try{oa(a,d,!0,!0)}catch(m){return void ka(a,"Invalid regex: "+d)}if(j=j||Wa.lastSubstituteReplacePart,void 0===j)return void ka(a,"No previous substitute regular expression");var n=ca(a),o=n.getQuery(),q=void 0!==b.line?b.line:a.getCursor().line,r=b.lineEnd||q;g&&(q=r,r=q+g-1);var s=y(a,c(q,0)),t=a.getSearchCursor(o,s);wa(a,k,l,q,r,t,o,j,b.callback)},redo:a.commands.redo,undo:a.commands.undo,write:function(b){a.commands.save?a.commands.save(b):b.save()},nohlsearch:function(a){sa(a)},delmarks:function(b,c){if(!c.argString||!J(c.argString))return void ka(b,"Argument required");for(var d=b.state.vim,e=new a.StringStream(J(c.argString));!e.eol();){e.eatSpace();var f=e.pos;if(!e.match(/[a-zA-Z]/,!1))return void ka(b,"Invalid argument: "+c.argString.substring(f));var g=e.next();if(e.match("-",!0)){if(!e.match(/[a-zA-Z]/,!1))return void ka(b,"Invalid argument: "+c.argString.substring(f));var i=g,j=e.next();if(!(h(i)&&h(j)||k(i)&&k(j)))return void ka(b,"Invalid argument: "+i+"-");var l=i.charCodeAt(0),m=j.charCodeAt(0);if(l>=m)return void ka(b,"Invalid argument: "+c.argString.substring(f));for(var n=0;m-l>=n;n++){var o=String.fromCharCode(l+n);delete d.marks[o]}}else delete d.marks[g]}}},fb=new d.ExCommandDispatcher;return a.keyMap.vim=xa(),a.keyMap["vim-insert"]={Esc:ya,"Ctrl-[":ya,"Ctrl-C":ya,"Ctrl-N":"autocomplete","Ctrl-P":"autocomplete",Enter:function(b){var c=a.commands.newlineAndIndentContinueComment||a.commands.newlineAndIndent;c(b)},fallthrough:["default"]},a.keyMap["vim-replace"]={Backspace:"goCharLeft",fallthrough:["vim-insert"]},s(),Xa};a.Vim=d()});